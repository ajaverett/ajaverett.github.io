{"title":"Second Amendment History","markdown":{"yaml":{"title":"Second Amendment History","subtitle":"Timeline of the Second Amendment Development","image":"images/washington.png","categories":["guns","second amendment","interactive","history"],"resources":"data/history_events.json","format":{"html":{"minimal":true,"css":"../styles/historytemp.css","anchor-sections":true,"page-layout":"full","toc":false,"include-in-header":{"text":"<script src=\"https://cdn.tailwindcss.com\"></script>\n\n<link href=\"https://fonts.googleapis.com/css2?family=IM+Fell+English:ital@0;1&family=Lato:wght@400;700&display=swap\" rel=\"stylesheet\">\n"},"include-after-body":{"text":"<script>\n    // --- CONFIGURATION ---\n    const CONFIG = {\n        START_DATE: new Date(\"1773-12-01\"),\n        END_DATE: new Date(\"1792-12-31\"),\n        TOTAL_WIDTH: 10000, // Pixels for the total timeline length\n        TRIGGER_THRESHOLD: 50, // Pixels from center to trigger event\n        VERTICAL_OFFSET: 20,\n    };\n\n    // Optimization: Define Month names once globally\n    const MONTHS = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n                    \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n\n    // Hardcoded States (sorted by ratification generally, or geographic)\n    const STATES = [\n        { name: \"Delaware\", abbr: \"DE\" },\n        { name: \"Pennsylvania\", abbr: \"PA\" },\n        { name: \"New Jersey\", abbr: \"NJ\" },\n        { name: \"Georgia\", abbr: \"GA\" },\n        { name: \"Connecticut\", abbr: \"CT\" },\n        { name: \"Massachusetts\", abbr: \"MA\" },\n        { name: \"Maryland\", abbr: \"MD\" },\n        { name: \"South Carolina\", abbr: \"SC\" },\n        { name: \"New Hampshire\", abbr: \"NH\" },\n        { name: \"Virginia\", abbr: \"VA\" },\n        { name: \"New York\", abbr: \"NY\" },\n        { name: \"North Carolina\", abbr: \"NC\" },\n        { name: \"Rhode Island\", abbr: \"RI\" }\n    ];\n\n    let eventsData = [];\n    let activeEventId = null;\n    let lastDateString = '';\n\n    // --- DOM ELEMENTS ---\n    const elements = {\n        sidebar: document.getElementById('state-list-container'),\n        timelineViewport: document.getElementById('timeline-viewport'),\n        timelineContent: document.getElementById('timeline-content'),\n        gridLines: document.getElementById('grid-lines'),\n        eventsContainer: document.getElementById('events-container'),\n        infoCard: document.getElementById('info-card'),\n        cinematicBg: document.getElementById('cinematic-bg'),\n        dateDisplay: document.getElementById('current-date-display'),\n        // Card Elements\n        cardTitle: document.getElementById('card-title'),\n        cardDate: document.getElementById('card-date'),\n        cardDesc: document.getElementById('card-desc'),\n        cardImgContainer: document.getElementById('card-image-container'),\n        cardImg: document.getElementById('card-image'),\n        nextBtn: document.getElementById('next-btn')\n    };\n\n    // --- INITIALIZATION ---\n\n    async function init() {\n        // PERFORMANCE: Inject content-visibility styles dynamically\n        // This stops the browser from rendering off-screen pixels\n        elements.eventsContainer.style.contentVisibility = 'auto';\n        elements.eventsContainer.style.containIntrinsicSize = `${CONFIG.TOTAL_WIDTH}px 500px`;\n        elements.gridLines.style.contentVisibility = 'auto';\n        elements.gridLines.style.containIntrinsicSize = `${CONFIG.TOTAL_WIDTH}px 500px`;\n\n        setupLayout();\n        renderSidebar();\n        renderGridBackground();\n\n        window.addEventListener('resize', setupLayout);\n\n        document.fonts.ready.then(() => {\n            setupLayout();\n        });\n\n        try {\n            const response = await fetch('data/history_events.json');\n            if (!response.ok) throw new Error('Network response not ok');\n            eventsData = await response.json();\n            renderEvents();\n            renderBanners();\n\n            // --- NEW: NEXT BUTTON LOGIC ---\n            elements.nextBtn.addEventListener('click', () => {\n                const currentPos = elements.timelineViewport.scrollLeft;\n\n                // Find the first event that is at least 50px ahead of current view\n                // (The 50px buffer prevents getting stuck on the current event)\n                const nextEvent = eventsData.find(e => e.pixelLocation > currentPos + 50);\n\n                if (nextEvent) {\n                    elements.timelineViewport.scrollTo({\n                        left: nextEvent.pixelLocation,\n                        behavior: 'smooth'\n                    });\n                } else {\n                    // Optional: If at the end, loop back to start?\n                    // elements.timelineViewport.scrollTo({ left: 0, behavior: 'smooth' });\n                }\n            });\n\n\n            requestAnimationFrame(updateLoop);\n        } catch (error) {\n            console.error(\"Error loading events:\", error);\n        }\n    }\n    function setupLayout() {\n\n        elements.timelineViewport.style.willChange = 'scroll-position';\n\n        // 1. Set Timeline Total Width\n        elements.timelineContent.style.width = `${CONFIG.TOTAL_WIDTH}px`;\n        elements.sidebar.style.paddingTop = `${CONFIG.VERTICAL_OFFSET}px`;\n\n        // 2. Force content-box logic\n        elements.timelineContent.style.boxSizing = 'content-box';\n\n        // 3. Dynamic Padding Calculation\n        const halfScreen = window.innerWidth / 2;\n\n        // Safety check: ensure sidebar exists before measuring\n        const sidebarEl = document.getElementById('sidebar');\n        const sidebarWidth = sidebarEl ? sidebarEl.getBoundingClientRect().width : 0;\n\n        // LEFT PADDING:\n        // We want pixel 0 of the timeline to sit exactly under the playhead (center screen)\n        // when the scroll bar is at 0.\n        // Screen Center = Sidebar Width + (Remaining Space / 2) is incorrect logic.\n        // Correct Logic: The Playhead is at absolute 50vw.\n        // The content container starts at 'sidebarWidth'.\n        // So we need padding = (50vw - sidebarWidth).\n        const padLeft = halfScreen - sidebarWidth;\n\n        elements.timelineContent.style.paddingLeft = `${Math.max(0, padLeft)}px`;\n        elements.timelineContent.style.paddingRight = `${halfScreen}px`;\n    }\n    // --- RENDERING ---\n\n    function renderSidebar() {\n        STATES.forEach((state, index) => {\n            const row = document.createElement('div');\n\n            row.className = 'state-row h-[40px] flex items-center px-4 font-fell text-lg text-[#2c1810]';\n\n            row.dataset.state = state.name;\n            row.innerHTML = `\n                <span class=\"hidden md:block\">${state.name}</span>\n                <span class=\"md:hidden font-bold\">${state.abbr}</span>\n            `;\n            elements.sidebar.appendChild(row);\n        });\n    }\n\n    function renderGridBackground() {\n        // 1. Horizontal Lines (matching sidebar rows)\n        STATES.forEach((state, index) => {\n                const line = document.createElement('div');\n                line.className = 'timeline-row-line h-[40px] w-full absolute';\n\n                // CHANGED: Added + 60 to push grid down\n                line.style.top = `${(index * 40) + CONFIG.VERTICAL_OFFSET}px`;\n\n                line.dataset.stateRow = state.name;\n                elements.gridLines.appendChild(line);\n            });\n        // 2. Vertical Year Markers\n        const startYear = CONFIG.START_DATE.getFullYear();\n        const endYear = CONFIG.END_DATE.getFullYear();\n\n        for (let year = startYear; year <= endYear; year++) {\n            const dateStr = `${year}-01-01`;\n            const leftPos = dateToPixel(dateStr);\n\n            const marker = document.createElement('div');\n            marker.className = 'absolute top-0 bottom-0 border-l border-[#2c1810]/20 font-fell text-4xl text-[#2c1810]/10 pl-2 select-none';\n            marker.style.left = `${leftPos}px`;\n            marker.innerText = year;\n            elements.gridLines.appendChild(marker);\n        }\n    }\n\n    function renderEvents() {\n        elements.eventsContainer.innerHTML = '';\n        const placedLabels = [];\n\n        eventsData.forEach((event, index) => {\n            // --- OPTIMIZATION STEP ---\n            const leftPos = dateToPixel(event.date);\n            event.pixelLocation = leftPos; // STORE THIS for the update loop\n            event.id = index;\n            // -------------------------\n\n            // 1. VERTICAL DROP LINE\n            const dropLine = document.createElement('div');\n            dropLine.className = 'absolute top-0 bottom-0 border-l border-dashed border-[#2c1810]/20 pointer-events-none z-0';\n            dropLine.style.left = `${leftPos}px`;\n            elements.eventsContainer.appendChild(dropLine);\n            event.domElement = dropLine;\n\n            // CHECK: Is this a \"Pure\" Union event?\n            const isPureUnion = event.involved.includes(\"All\") && !event.location;\n\n            if (isPureUnion) {\n                // --- UNION RENDER ---\n                const unionLine = document.createElement('div');\n                unionLine.className = 'absolute top-0 md:-top-[50px] bottom-0 w-[4px] bg-[#2c1810] z-20 transform -translate-x-1/2';\n                unionLine.style.left = `${leftPos}px`;\n\n                const badge = document.createElement('div');\n                badge.className = 'absolute top-[40%] left-1/2 transform -translate-x-1/2 bg-[#2c1810] text-[#fdfbf7] px-3 py-1 font-fell text-lg tracking-widest whitespace-nowrap shadow-lg border border-[#fdfbf7]/20';\n                badge.innerText = event.title.toUpperCase();\n\n                unionLine.appendChild(badge);\n                elements.eventsContainer.appendChild(unionLine);\n\n            } else {\n                // --- STATE/ROW RENDER ---\n\n                // A. Determine target states\n                let targetStates = [];\n                if (event.location) {\n                    targetStates = [event.location];\n                } else {\n                    targetStates = event.involved;\n                }\n\n                // B. Find Primary State (for label placement)\n                const sortedTargets = targetStates.map(name => {\n                    return { name, index: STATES.findIndex(s => s.name === name) };\n                }).sort((a, b) => a.index - b.index);\n\n                const primaryState = sortedTargets[0];\n                if (!primaryState || primaryState.index === -1) return;\n\n                // C. Render Diamonds\n                targetStates.forEach(stateName => {\n                    const sIndex = STATES.findIndex(s => s.name === stateName);\n                    if (sIndex === -1) return;\n\n                    const topPos = (sIndex * 40) + 20 + CONFIG.VERTICAL_OFFSET;\n\n                    const wrapper = document.createElement('div');\n                    wrapper.className = 'absolute transform -translate-x-1/2 -translate-y-1/2 z-30 group cursor-help';\n                    wrapper.style.left = `${leftPos}px`; // Uses calculated pixel\n                    wrapper.style.top = `${topPos}px`;\n\n                    const diamond = document.createElement('div');\n                    diamond.className = 'w-4 h-4 bg-[#8b0000] rotate-45 shadow-sm transition-transform duration-200 group-hover:scale-150';\n                    wrapper.appendChild(diamond);\n\n                    if (event.tooltip && event.tooltip[stateName]) {\n                        const tip = document.createElement('div');\n                        tip.className = 'absolute top-6 left-1/2 -translate-x-1/2 bg-[#2c1810] text-[#fdfbf7] text-[11px] font-lato tracking-wide p-3 rounded w-max max-w-[220px] opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none shadow-2xl border border-[#fdfbf7]/10 z-50';\n                        tip.innerHTML = event.tooltip[stateName];\n                        wrapper.appendChild(tip);\n                    }\n                    elements.eventsContainer.appendChild(wrapper);\n                });\n\n                // D. Collision Detection & Label Placement\n                let labelX = leftPos + 15;\n                let labelY = (primaryState.index * 40) + 5 + CONFIG.VERTICAL_OFFSET;\n\n                let charWidth = event.type === 'large' ? 14 : 10;\n                const textWidth = (event.title.length * charWidth) + 20;\n                const textHeight = 40;\n\n                let collision = true;\n                let safetyCounter = 0;\n\n                while (collision && safetyCounter < 20) {\n                    collision = false;\n                    for (const placed of placedLabels) {\n                        const xOverlap = (labelX < placed.right + 10) && ((labelX + textWidth) > placed.left);\n                        const yOverlap = (labelY < placed.bottom) && ((labelY + textHeight) > placed.top);\n                        if (xOverlap && yOverlap) {\n                            collision = true;\n                            labelY += 40;\n                            break;\n                        }\n                    }\n                    safetyCounter++;\n                }\n\n                placedLabels.push({ left: labelX, right: labelX + textWidth, top: labelY, bottom: labelY + textHeight });\n\n                const label = document.createElement('div');\n                let baseClasses = 'absolute font-fell italic whitespace-nowrap select-none z-20 pointer-events-none text-[#2c1810] ';\n\n                if (event.type === 'large') {\n                    label.className = baseClasses + 'text-3xl font-bold opacity-100 drop-shadow-md';\n                } else if (event.type === 'medium') {\n                    label.className = baseClasses + 'text-xl font-bold opacity-80';\n                } else {\n                    label.className = baseClasses + 'text-lg opacity-60';\n                }\n\n                label.style.left = `${labelX}px`;\n                label.style.top = `${labelY}px`;\n                label.innerText = event.title;\n                elements.eventsContainer.appendChild(label);\n            }\n        });\n    }\n\n    function renderBanners() {\n        eventsData.forEach(event => {\n            if (event.type !== 'banner' || !event.endDate) return;\n\n            const startX = dateToPixel(event.date);\n            const endX = dateToPixel(event.endDate);\n            const width = endX - startX;\n\n            // 1. The Horizontal Bar (Visual Duration)\n            const bannerBar = document.createElement('div');\n            // Red background/border with low opacity\n            // Added 'flex' to manage the sticky child correctly\n            bannerBar.className = 'absolute top-0 h-[8px] bg-[#8b0000]/20 border-b border-[#8b0000]/30 z-0 pointer-events-none flex';\n            bannerBar.style.left = `${startX}px`;\n            bannerBar.style.width = `${width}px`;\n\n            // 2. The Sliding Label (CSS Sticky)\n            const labelDiv = document.createElement('div');\n\n            // EXPLANATION OF CLASSES:\n            // 'sticky': Tells browser to stick this element to the view\n            // 'left-0': Sticks it to the left edge of the camera\n            // 'mt-3': Pushes it down below the 8px bar\n            // 'pl-2': Adds a little padding so it doesn't touch the screen edge\n            // 'text-[#2c1810]/50': Brown text (slightly more visible 50% opacity)\n            labelDiv.className = 'sticky left-0 mt-3 pl-2 text-[10px] font-bold font-lato text-[#2c1810]/50 uppercase tracking-widest whitespace-nowrap self-start';\n            labelDiv.innerText = `${event.title}`;\n\n            bannerBar.appendChild(labelDiv);\n            elements.eventsContainer.appendChild(bannerBar);\n\n            // Save positions (still useful for other logic if needed)\n            event.bannerStart = startX;\n            event.bannerEnd = endX;\n        });\n    }\n\n    // --- MATH HELPERS ---\n\n    function dateToPixel(dateString) {\n        const date = new Date(dateString);\n        const totalTime = CONFIG.END_DATE - CONFIG.START_DATE;\n        const eventTime = date - CONFIG.START_DATE;\n        const percentage = eventTime / totalTime;\n        return percentage * CONFIG.TOTAL_WIDTH;\n    }\n\n    function pixelToDate(pixel) {\n        const percentage = pixel / CONFIG.TOTAL_WIDTH;\n        const startMs = CONFIG.START_DATE.getTime();\n        const endMs = CONFIG.END_DATE.getTime();\n        const totalMs = endMs - startMs;\n        const currentMs = startMs + (totalMs * percentage);\n\n        const date = new Date(currentMs);\n        const year = date.getFullYear();\n        const monthIndex = date.getMonth();\n\n        // FIX 2: Uses global const MONTHS instead of recreating array\n        return `${MONTHS[monthIndex]}, ${year}`;\n    }\n\n    // --- THE GAME LOOP (RequestAnimationFrame) ---\n\n    function updateLoop() {\n        // 1. Get current scroll position (The only DOM read we need)\n        const scrollLeft = elements.timelineViewport.scrollLeft;\n\n        // 2. Update Date Display\n        // We clamp the value so it doesn't show crazy dates if the user \"bounces\" the scroll on Mac/iOS\n        const clampedPixel = Math.max(0, Math.min(CONFIG.TOTAL_WIDTH, scrollLeft));\n        const newDateStr = pixelToDate(clampedPixel);\n\n        // ONLY touch the DOM if the text actually changed\n        if (newDateStr !== lastDateString) {\n            elements.dateDisplay.innerText = newDateStr;\n            lastDateString = newDateStr;\n        }\n\n        // 3. Find Active Event using PURE MATH\n        // Because we padded the timeline in setupLayout(),\n        // the scrollLeft value corresponds exactly to the pixel on the timeline\n        // that is currently under the center playhead.\n\n        let foundEvent = null;\n        let closestDist = CONFIG.TRIGGER_THRESHOLD; // Use your config const (e.g. 200)\n\n        // Fast Loop\n        for (let i = 0; i < eventsData.length; i++) {\n            const event = eventsData[i];\n\n            // Math.abs(EventLocation - CurrentScrollPosition)\n            const dist = Math.abs(event.pixelLocation - scrollLeft);\n\n            if (dist < closestDist) {\n                closestDist = dist;\n                foundEvent = event;\n            }\n        }\n\n        // 4. State Management\n        if (foundEvent && foundEvent.id !== activeEventId) {\n            activateEvent(foundEvent);\n        } else if (!foundEvent && activeEventId !== null) {\n            deactivateEvent();\n        }\n\n        requestAnimationFrame(updateLoop);\n    }\n\n\n\n    // --- INTERACTION LOGIC ---\n\n    function activateEvent(event) {\n        activeEventId = event.id;\n\n        // 1. Update Card Content\n        elements.cardTitle.innerText = event.title;\n        elements.cardDate.innerText = formatFriendlyDate(event.date);\n        elements.cardDesc.innerText = event.description;\n\n        // CHANGED: Logic to show image if it exists, regardless of 'type'\n        if (event.image) {\n            elements.cardImg.src = event.image;\n            elements.cardImgContainer.classList.remove('hidden');\n        } else {\n            elements.cardImgContainer.classList.add('hidden');\n        }\n\n        elements.infoCard.classList.remove('translate-y-[120%]');\n\n        // ... (Keep the rest of the function: \"Matrix Lines\", \"Cinematic BG\", \"Hybrid Check\" etc.)\n        // ...\n        // 2. Handle \"Matrix\" Lines\n        document.querySelectorAll('.state-row, .timeline-row-line').forEach(el => el.classList.remove('active'));\n\n        if (event.involved.includes(\"All\")) {\n            // ... (Keep existing Union Logic)\n            if (event.type === 'large' && event.bgImage) {\n                elements.cinematicBg.style.backgroundImage = `url('${event.bgImage}')`;\n                elements.cinematicBg.classList.remove('opacity-0');\n                elements.sidebar.classList.add('opacity-50');\n                elements.gridLines.classList.add('blur-mode');\n            }\n            if (event.location) {\n                const sidebarRow = document.querySelector(`.state-row[data-state=\"${event.location}\"]`);\n                if (sidebarRow) sidebarRow.classList.add('active');\n                const gridRow = document.querySelector(`.timeline-row-line[data-state-row=\"${event.location}\"]`);\n                if (gridRow) gridRow.classList.add('active');\n            }\n        } else {\n            // ... (Keep existing State Logic)\n            event.involved.forEach(stateName => {\n                const sidebarRow = document.querySelector(`.state-row[data-state=\"${stateName}\"]`);\n                if (sidebarRow) sidebarRow.classList.add('active');\n                const gridRow = document.querySelector(`.timeline-row-line[data-state-row=\"${stateName}\"]`);\n                if (gridRow) gridRow.classList.add('active');\n            });\n        }\n    }\n\n    function deactivateEvent() {\n        activeEventId = null;\n\n        // Hide Card\n        elements.infoCard.classList.add('translate-y-[120%]');\n\n        // Reset Rows\n        document.querySelectorAll('.state-row, .timeline-row-line').forEach(el => el.classList.remove('active'));\n\n        // Reset Cinematic Mode\n        elements.cinematicBg.classList.add('opacity-0');\n        elements.sidebar.classList.remove('opacity-50');\n        elements.gridLines.classList.remove('blur-mode');\n    }\n\n    function formatFriendlyDate(dateString) {\n        // 1. Parse the date ensuring no timezone offsets shift the day\n        const [year, month, day] = dateString.split('-');\n        const date = new Date(year, month - 1, day);\n\n        // 2. Get Month Name\n        const monthName = date.toLocaleString('default', { month: 'long' });\n\n        // 3. Get Day and determine Suffix (st, nd, rd, th)\n        const d = parseInt(day);\n        let suffix = 'th';\n\n        if (d > 3 && d < 21) {\n            suffix = 'th'; // Covers 4-20 (11th, 12th, 13th)\n        } else {\n            switch (d % 10) {\n                case 1:  suffix = \"st\"; break;\n                case 2:  suffix = \"nd\"; break;\n                case 3:  suffix = \"rd\"; break;\n            }\n        }\n\n        return `${monthName} ${d}${suffix}, ${year}`;\n    }\n\n    // Start\n    init();\n</script>\n"}}}},"containsRefs":false,"markdown":"\n\n\n\n<div style=\"display: none;\">\nTimeline of the Second Amendment Development\n</div>\n\n\n```{=html}\n<div class=\"bg-[#fdfbf7] text-[#2c1810] overflow-hidden h-screen w-screen selection:bg-[#8b0000] selection:text-white\">\n\n    <div id=\"cinematic-bg\" class=\"absolute inset-0 bg-cover bg-center opacity-0 transition-opacity duration-300 z-0 pointer-events-none\"></div>\n\n    <div class=\"relative z-10 flex h-full w-full\">\n\n        <div id=\"sidebar\" class=\"flex-none w-[60px] md:w-[200px] h-full bg-[#f4f1ea] border-r-2 border-[#dcd6ce] z-20 shadow-xl overflow-hidden relative flex flex-col\">\n            \n            <div class=\"h-[50px] hidden md:flex items-center justify-center border-b border-[#dcd6ce] font-fell italic text-xl flex-none bg-[#f4f1ea] z-10\">\n                <span>The States </span>\n            </div>\n            \n            <div id=\"state-list-container\" class=\"flex flex-col overflow-y-auto flex-1 relative\">\n                </div>\n\n            <button id=\"next-btn\" class=\"flex-none w-full h-[60px] bg-[#8b0000] text-[#fdfbf7] flex items-center justify-center hover:bg-[#a00000] transition-colors duration-300 border-t-2 border-[#dcd6ce]\">\n                <span class=\"font-bold text-2xl\">➔</span>\n            </button>\n        </div>\n\n        <div id=\"timeline-viewport\" class=\"flex-1 relative overflow-x-scroll overflow-y-hidden custom-scrollbar\">\n                \n            <div id=\"playhead\" class=\"fixed top-0 bottom-0 left-1/2 w-[2px] bg-[#8b0000] z-10 transform -translate-x-1/2 pointer-events-none shadow-[0_0_10px_rgba(139,0,0,0.5)]\">\n                <div class=\"hidden md:block absolute top-2 left-1/2 -translate-x-1/2 bg-[#8b0000] text-[#fdfbf7] px-2 py-1 text-xs font-bold rounded font-lato whitespace-nowrap\">\n                    <span id=\"current-date-display\">1785</span>\n                </div>\n            </div>\n\n            <div id=\"timeline-content\" class=\"relative h-full\">\n                \n                <div id=\"timeline-offset\" class=\"relative w-full h-full mt-0 md:mt-[50px]\">\n                    \n                    <div id=\"grid-lines\" class=\"absolute inset-0 pointer-events-none\"></div>\n                    \n                    <div id=\"events-container\" class=\"absolute inset-0 w-full h-full\"></div>\n                    \n                </div>\n            </div>\n\n        </div>\n    </div>\n\n    <div id=\"info-card\" class=\"fixed bottom-0 left-[60px] right-0 md:left-auto md:right-8 md:bottom-8 md:w-[400px] bg-[#fdfbf7] border-t md:border-2 border-[#2c1810] shadow-2xl transform translate-y-[120%] transition-transform duration-500 z-40 p-4 rounded-t-lg md:rounded-lg\">\n        <div id=\"card-content\">\n            \n            <div id=\"card-image-container\" class=\"hidden mb-3 overflow-hidden rounded border border-[#2c1810] opacity-100 sepia-[.2]\">\n                <img id=\"card-image\" src=\"\" alt=\"\" class=\"w-full h-48 object-cover block\">\n            </div>\n            \n            <div class=\"border-b border-[#2c1810]/20 pb-2 mb-2\">\n                <h2 id=\"card-title\" class=\"font-fell text-2xl md:text-3xl text-[#8b0000] leading-none mb-1\">Event Title</h2>\n                <p id=\"card-date\" class=\"font-lato text-xs font-bold text-[#2c1810]/50 uppercase tracking-widest\">Date</p>\n            </div>\n\n            <p id=\"card-desc\" class=\"font-lato text-sm md:text-base leading-relaxed text-[#2c1810]\"></p>\n        </div>\n    </div>\n\n\n</div> \n\n```","srcMarkdownNoYaml":"\n\n\n\n<div style=\"display: none;\">\nTimeline of the Second Amendment Development\n</div>\n\n\n```{=html}\n<div class=\"bg-[#fdfbf7] text-[#2c1810] overflow-hidden h-screen w-screen selection:bg-[#8b0000] selection:text-white\">\n\n    <div id=\"cinematic-bg\" class=\"absolute inset-0 bg-cover bg-center opacity-0 transition-opacity duration-300 z-0 pointer-events-none\"></div>\n\n    <div class=\"relative z-10 flex h-full w-full\">\n\n        <div id=\"sidebar\" class=\"flex-none w-[60px] md:w-[200px] h-full bg-[#f4f1ea] border-r-2 border-[#dcd6ce] z-20 shadow-xl overflow-hidden relative flex flex-col\">\n            \n            <div class=\"h-[50px] hidden md:flex items-center justify-center border-b border-[#dcd6ce] font-fell italic text-xl flex-none bg-[#f4f1ea] z-10\">\n                <span>The States </span>\n            </div>\n            \n            <div id=\"state-list-container\" class=\"flex flex-col overflow-y-auto flex-1 relative\">\n                </div>\n\n            <button id=\"next-btn\" class=\"flex-none w-full h-[60px] bg-[#8b0000] text-[#fdfbf7] flex items-center justify-center hover:bg-[#a00000] transition-colors duration-300 border-t-2 border-[#dcd6ce]\">\n                <span class=\"font-bold text-2xl\">➔</span>\n            </button>\n        </div>\n\n        <div id=\"timeline-viewport\" class=\"flex-1 relative overflow-x-scroll overflow-y-hidden custom-scrollbar\">\n                \n            <div id=\"playhead\" class=\"fixed top-0 bottom-0 left-1/2 w-[2px] bg-[#8b0000] z-10 transform -translate-x-1/2 pointer-events-none shadow-[0_0_10px_rgba(139,0,0,0.5)]\">\n                <div class=\"hidden md:block absolute top-2 left-1/2 -translate-x-1/2 bg-[#8b0000] text-[#fdfbf7] px-2 py-1 text-xs font-bold rounded font-lato whitespace-nowrap\">\n                    <span id=\"current-date-display\">1785</span>\n                </div>\n            </div>\n\n            <div id=\"timeline-content\" class=\"relative h-full\">\n                \n                <div id=\"timeline-offset\" class=\"relative w-full h-full mt-0 md:mt-[50px]\">\n                    \n                    <div id=\"grid-lines\" class=\"absolute inset-0 pointer-events-none\"></div>\n                    \n                    <div id=\"events-container\" class=\"absolute inset-0 w-full h-full\"></div>\n                    \n                </div>\n            </div>\n\n        </div>\n    </div>\n\n    <div id=\"info-card\" class=\"fixed bottom-0 left-[60px] right-0 md:left-auto md:right-8 md:bottom-8 md:w-[400px] bg-[#fdfbf7] border-t md:border-2 border-[#2c1810] shadow-2xl transform translate-y-[120%] transition-transform duration-500 z-40 p-4 rounded-t-lg md:rounded-lg\">\n        <div id=\"card-content\">\n            \n            <div id=\"card-image-container\" class=\"hidden mb-3 overflow-hidden rounded border border-[#2c1810] opacity-100 sepia-[.2]\">\n                <img id=\"card-image\" src=\"\" alt=\"\" class=\"w-full h-48 object-cover block\">\n            </div>\n            \n            <div class=\"border-b border-[#2c1810]/20 pb-2 mb-2\">\n                <h2 id=\"card-title\" class=\"font-fell text-2xl md:text-3xl text-[#8b0000] leading-none mb-1\">Event Title</h2>\n                <p id=\"card-date\" class=\"font-lato text-xs font-bold text-[#2c1810]/50 uppercase tracking-widest\">Date</p>\n            </div>\n\n            <p id=\"card-desc\" class=\"font-lato text-sm md:text-base leading-relaxed text-[#2c1810]\"></p>\n        </div>\n    </div>\n\n\n</div> \n\n```"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles/historytemp.css"],"toc":false,"include-in-header":{"text":"<script src=\"https://cdn.tailwindcss.com\"></script>\n\n<link href=\"https://fonts.googleapis.com/css2?family=IM+Fell+English:ital@0;1&family=Lato:wght@400;700&display=swap\" rel=\"stylesheet\">\n"},"include-after-body":{"text":"<script>\n    // --- CONFIGURATION ---\n    const CONFIG = {\n        START_DATE: new Date(\"1773-12-01\"),\n        END_DATE: new Date(\"1792-12-31\"),\n        TOTAL_WIDTH: 10000, // Pixels for the total timeline length\n        TRIGGER_THRESHOLD: 50, // Pixels from center to trigger event\n        VERTICAL_OFFSET: 20,\n    };\n\n    // Optimization: Define Month names once globally\n    const MONTHS = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n                    \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n\n    // Hardcoded States (sorted by ratification generally, or geographic)\n    const STATES = [\n        { name: \"Delaware\", abbr: \"DE\" },\n        { name: \"Pennsylvania\", abbr: \"PA\" },\n        { name: \"New Jersey\", abbr: \"NJ\" },\n        { name: \"Georgia\", abbr: \"GA\" },\n        { name: \"Connecticut\", abbr: \"CT\" },\n        { name: \"Massachusetts\", abbr: \"MA\" },\n        { name: \"Maryland\", abbr: \"MD\" },\n        { name: \"South Carolina\", abbr: \"SC\" },\n        { name: \"New Hampshire\", abbr: \"NH\" },\n        { name: \"Virginia\", abbr: \"VA\" },\n        { name: \"New York\", abbr: \"NY\" },\n        { name: \"North Carolina\", abbr: \"NC\" },\n        { name: \"Rhode Island\", abbr: \"RI\" }\n    ];\n\n    let eventsData = [];\n    let activeEventId = null;\n    let lastDateString = '';\n\n    // --- DOM ELEMENTS ---\n    const elements = {\n        sidebar: document.getElementById('state-list-container'),\n        timelineViewport: document.getElementById('timeline-viewport'),\n        timelineContent: document.getElementById('timeline-content'),\n        gridLines: document.getElementById('grid-lines'),\n        eventsContainer: document.getElementById('events-container'),\n        infoCard: document.getElementById('info-card'),\n        cinematicBg: document.getElementById('cinematic-bg'),\n        dateDisplay: document.getElementById('current-date-display'),\n        // Card Elements\n        cardTitle: document.getElementById('card-title'),\n        cardDate: document.getElementById('card-date'),\n        cardDesc: document.getElementById('card-desc'),\n        cardImgContainer: document.getElementById('card-image-container'),\n        cardImg: document.getElementById('card-image'),\n        nextBtn: document.getElementById('next-btn')\n    };\n\n    // --- INITIALIZATION ---\n\n    async function init() {\n        // PERFORMANCE: Inject content-visibility styles dynamically\n        // This stops the browser from rendering off-screen pixels\n        elements.eventsContainer.style.contentVisibility = 'auto';\n        elements.eventsContainer.style.containIntrinsicSize = `${CONFIG.TOTAL_WIDTH}px 500px`;\n        elements.gridLines.style.contentVisibility = 'auto';\n        elements.gridLines.style.containIntrinsicSize = `${CONFIG.TOTAL_WIDTH}px 500px`;\n\n        setupLayout();\n        renderSidebar();\n        renderGridBackground();\n\n        window.addEventListener('resize', setupLayout);\n\n        document.fonts.ready.then(() => {\n            setupLayout();\n        });\n\n        try {\n            const response = await fetch('data/history_events.json');\n            if (!response.ok) throw new Error('Network response not ok');\n            eventsData = await response.json();\n            renderEvents();\n            renderBanners();\n\n            // --- NEW: NEXT BUTTON LOGIC ---\n            elements.nextBtn.addEventListener('click', () => {\n                const currentPos = elements.timelineViewport.scrollLeft;\n\n                // Find the first event that is at least 50px ahead of current view\n                // (The 50px buffer prevents getting stuck on the current event)\n                const nextEvent = eventsData.find(e => e.pixelLocation > currentPos + 50);\n\n                if (nextEvent) {\n                    elements.timelineViewport.scrollTo({\n                        left: nextEvent.pixelLocation,\n                        behavior: 'smooth'\n                    });\n                } else {\n                    // Optional: If at the end, loop back to start?\n                    // elements.timelineViewport.scrollTo({ left: 0, behavior: 'smooth' });\n                }\n            });\n\n\n            requestAnimationFrame(updateLoop);\n        } catch (error) {\n            console.error(\"Error loading events:\", error);\n        }\n    }\n    function setupLayout() {\n\n        elements.timelineViewport.style.willChange = 'scroll-position';\n\n        // 1. Set Timeline Total Width\n        elements.timelineContent.style.width = `${CONFIG.TOTAL_WIDTH}px`;\n        elements.sidebar.style.paddingTop = `${CONFIG.VERTICAL_OFFSET}px`;\n\n        // 2. Force content-box logic\n        elements.timelineContent.style.boxSizing = 'content-box';\n\n        // 3. Dynamic Padding Calculation\n        const halfScreen = window.innerWidth / 2;\n\n        // Safety check: ensure sidebar exists before measuring\n        const sidebarEl = document.getElementById('sidebar');\n        const sidebarWidth = sidebarEl ? sidebarEl.getBoundingClientRect().width : 0;\n\n        // LEFT PADDING:\n        // We want pixel 0 of the timeline to sit exactly under the playhead (center screen)\n        // when the scroll bar is at 0.\n        // Screen Center = Sidebar Width + (Remaining Space / 2) is incorrect logic.\n        // Correct Logic: The Playhead is at absolute 50vw.\n        // The content container starts at 'sidebarWidth'.\n        // So we need padding = (50vw - sidebarWidth).\n        const padLeft = halfScreen - sidebarWidth;\n\n        elements.timelineContent.style.paddingLeft = `${Math.max(0, padLeft)}px`;\n        elements.timelineContent.style.paddingRight = `${halfScreen}px`;\n    }\n    // --- RENDERING ---\n\n    function renderSidebar() {\n        STATES.forEach((state, index) => {\n            const row = document.createElement('div');\n\n            row.className = 'state-row h-[40px] flex items-center px-4 font-fell text-lg text-[#2c1810]';\n\n            row.dataset.state = state.name;\n            row.innerHTML = `\n                <span class=\"hidden md:block\">${state.name}</span>\n                <span class=\"md:hidden font-bold\">${state.abbr}</span>\n            `;\n            elements.sidebar.appendChild(row);\n        });\n    }\n\n    function renderGridBackground() {\n        // 1. Horizontal Lines (matching sidebar rows)\n        STATES.forEach((state, index) => {\n                const line = document.createElement('div');\n                line.className = 'timeline-row-line h-[40px] w-full absolute';\n\n                // CHANGED: Added + 60 to push grid down\n                line.style.top = `${(index * 40) + CONFIG.VERTICAL_OFFSET}px`;\n\n                line.dataset.stateRow = state.name;\n                elements.gridLines.appendChild(line);\n            });\n        // 2. Vertical Year Markers\n        const startYear = CONFIG.START_DATE.getFullYear();\n        const endYear = CONFIG.END_DATE.getFullYear();\n\n        for (let year = startYear; year <= endYear; year++) {\n            const dateStr = `${year}-01-01`;\n            const leftPos = dateToPixel(dateStr);\n\n            const marker = document.createElement('div');\n            marker.className = 'absolute top-0 bottom-0 border-l border-[#2c1810]/20 font-fell text-4xl text-[#2c1810]/10 pl-2 select-none';\n            marker.style.left = `${leftPos}px`;\n            marker.innerText = year;\n            elements.gridLines.appendChild(marker);\n        }\n    }\n\n    function renderEvents() {\n        elements.eventsContainer.innerHTML = '';\n        const placedLabels = [];\n\n        eventsData.forEach((event, index) => {\n            // --- OPTIMIZATION STEP ---\n            const leftPos = dateToPixel(event.date);\n            event.pixelLocation = leftPos; // STORE THIS for the update loop\n            event.id = index;\n            // -------------------------\n\n            // 1. VERTICAL DROP LINE\n            const dropLine = document.createElement('div');\n            dropLine.className = 'absolute top-0 bottom-0 border-l border-dashed border-[#2c1810]/20 pointer-events-none z-0';\n            dropLine.style.left = `${leftPos}px`;\n            elements.eventsContainer.appendChild(dropLine);\n            event.domElement = dropLine;\n\n            // CHECK: Is this a \"Pure\" Union event?\n            const isPureUnion = event.involved.includes(\"All\") && !event.location;\n\n            if (isPureUnion) {\n                // --- UNION RENDER ---\n                const unionLine = document.createElement('div');\n                unionLine.className = 'absolute top-0 md:-top-[50px] bottom-0 w-[4px] bg-[#2c1810] z-20 transform -translate-x-1/2';\n                unionLine.style.left = `${leftPos}px`;\n\n                const badge = document.createElement('div');\n                badge.className = 'absolute top-[40%] left-1/2 transform -translate-x-1/2 bg-[#2c1810] text-[#fdfbf7] px-3 py-1 font-fell text-lg tracking-widest whitespace-nowrap shadow-lg border border-[#fdfbf7]/20';\n                badge.innerText = event.title.toUpperCase();\n\n                unionLine.appendChild(badge);\n                elements.eventsContainer.appendChild(unionLine);\n\n            } else {\n                // --- STATE/ROW RENDER ---\n\n                // A. Determine target states\n                let targetStates = [];\n                if (event.location) {\n                    targetStates = [event.location];\n                } else {\n                    targetStates = event.involved;\n                }\n\n                // B. Find Primary State (for label placement)\n                const sortedTargets = targetStates.map(name => {\n                    return { name, index: STATES.findIndex(s => s.name === name) };\n                }).sort((a, b) => a.index - b.index);\n\n                const primaryState = sortedTargets[0];\n                if (!primaryState || primaryState.index === -1) return;\n\n                // C. Render Diamonds\n                targetStates.forEach(stateName => {\n                    const sIndex = STATES.findIndex(s => s.name === stateName);\n                    if (sIndex === -1) return;\n\n                    const topPos = (sIndex * 40) + 20 + CONFIG.VERTICAL_OFFSET;\n\n                    const wrapper = document.createElement('div');\n                    wrapper.className = 'absolute transform -translate-x-1/2 -translate-y-1/2 z-30 group cursor-help';\n                    wrapper.style.left = `${leftPos}px`; // Uses calculated pixel\n                    wrapper.style.top = `${topPos}px`;\n\n                    const diamond = document.createElement('div');\n                    diamond.className = 'w-4 h-4 bg-[#8b0000] rotate-45 shadow-sm transition-transform duration-200 group-hover:scale-150';\n                    wrapper.appendChild(diamond);\n\n                    if (event.tooltip && event.tooltip[stateName]) {\n                        const tip = document.createElement('div');\n                        tip.className = 'absolute top-6 left-1/2 -translate-x-1/2 bg-[#2c1810] text-[#fdfbf7] text-[11px] font-lato tracking-wide p-3 rounded w-max max-w-[220px] opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none shadow-2xl border border-[#fdfbf7]/10 z-50';\n                        tip.innerHTML = event.tooltip[stateName];\n                        wrapper.appendChild(tip);\n                    }\n                    elements.eventsContainer.appendChild(wrapper);\n                });\n\n                // D. Collision Detection & Label Placement\n                let labelX = leftPos + 15;\n                let labelY = (primaryState.index * 40) + 5 + CONFIG.VERTICAL_OFFSET;\n\n                let charWidth = event.type === 'large' ? 14 : 10;\n                const textWidth = (event.title.length * charWidth) + 20;\n                const textHeight = 40;\n\n                let collision = true;\n                let safetyCounter = 0;\n\n                while (collision && safetyCounter < 20) {\n                    collision = false;\n                    for (const placed of placedLabels) {\n                        const xOverlap = (labelX < placed.right + 10) && ((labelX + textWidth) > placed.left);\n                        const yOverlap = (labelY < placed.bottom) && ((labelY + textHeight) > placed.top);\n                        if (xOverlap && yOverlap) {\n                            collision = true;\n                            labelY += 40;\n                            break;\n                        }\n                    }\n                    safetyCounter++;\n                }\n\n                placedLabels.push({ left: labelX, right: labelX + textWidth, top: labelY, bottom: labelY + textHeight });\n\n                const label = document.createElement('div');\n                let baseClasses = 'absolute font-fell italic whitespace-nowrap select-none z-20 pointer-events-none text-[#2c1810] ';\n\n                if (event.type === 'large') {\n                    label.className = baseClasses + 'text-3xl font-bold opacity-100 drop-shadow-md';\n                } else if (event.type === 'medium') {\n                    label.className = baseClasses + 'text-xl font-bold opacity-80';\n                } else {\n                    label.className = baseClasses + 'text-lg opacity-60';\n                }\n\n                label.style.left = `${labelX}px`;\n                label.style.top = `${labelY}px`;\n                label.innerText = event.title;\n                elements.eventsContainer.appendChild(label);\n            }\n        });\n    }\n\n    function renderBanners() {\n        eventsData.forEach(event => {\n            if (event.type !== 'banner' || !event.endDate) return;\n\n            const startX = dateToPixel(event.date);\n            const endX = dateToPixel(event.endDate);\n            const width = endX - startX;\n\n            // 1. The Horizontal Bar (Visual Duration)\n            const bannerBar = document.createElement('div');\n            // Red background/border with low opacity\n            // Added 'flex' to manage the sticky child correctly\n            bannerBar.className = 'absolute top-0 h-[8px] bg-[#8b0000]/20 border-b border-[#8b0000]/30 z-0 pointer-events-none flex';\n            bannerBar.style.left = `${startX}px`;\n            bannerBar.style.width = `${width}px`;\n\n            // 2. The Sliding Label (CSS Sticky)\n            const labelDiv = document.createElement('div');\n\n            // EXPLANATION OF CLASSES:\n            // 'sticky': Tells browser to stick this element to the view\n            // 'left-0': Sticks it to the left edge of the camera\n            // 'mt-3': Pushes it down below the 8px bar\n            // 'pl-2': Adds a little padding so it doesn't touch the screen edge\n            // 'text-[#2c1810]/50': Brown text (slightly more visible 50% opacity)\n            labelDiv.className = 'sticky left-0 mt-3 pl-2 text-[10px] font-bold font-lato text-[#2c1810]/50 uppercase tracking-widest whitespace-nowrap self-start';\n            labelDiv.innerText = `${event.title}`;\n\n            bannerBar.appendChild(labelDiv);\n            elements.eventsContainer.appendChild(bannerBar);\n\n            // Save positions (still useful for other logic if needed)\n            event.bannerStart = startX;\n            event.bannerEnd = endX;\n        });\n    }\n\n    // --- MATH HELPERS ---\n\n    function dateToPixel(dateString) {\n        const date = new Date(dateString);\n        const totalTime = CONFIG.END_DATE - CONFIG.START_DATE;\n        const eventTime = date - CONFIG.START_DATE;\n        const percentage = eventTime / totalTime;\n        return percentage * CONFIG.TOTAL_WIDTH;\n    }\n\n    function pixelToDate(pixel) {\n        const percentage = pixel / CONFIG.TOTAL_WIDTH;\n        const startMs = CONFIG.START_DATE.getTime();\n        const endMs = CONFIG.END_DATE.getTime();\n        const totalMs = endMs - startMs;\n        const currentMs = startMs + (totalMs * percentage);\n\n        const date = new Date(currentMs);\n        const year = date.getFullYear();\n        const monthIndex = date.getMonth();\n\n        // FIX 2: Uses global const MONTHS instead of recreating array\n        return `${MONTHS[monthIndex]}, ${year}`;\n    }\n\n    // --- THE GAME LOOP (RequestAnimationFrame) ---\n\n    function updateLoop() {\n        // 1. Get current scroll position (The only DOM read we need)\n        const scrollLeft = elements.timelineViewport.scrollLeft;\n\n        // 2. Update Date Display\n        // We clamp the value so it doesn't show crazy dates if the user \"bounces\" the scroll on Mac/iOS\n        const clampedPixel = Math.max(0, Math.min(CONFIG.TOTAL_WIDTH, scrollLeft));\n        const newDateStr = pixelToDate(clampedPixel);\n\n        // ONLY touch the DOM if the text actually changed\n        if (newDateStr !== lastDateString) {\n            elements.dateDisplay.innerText = newDateStr;\n            lastDateString = newDateStr;\n        }\n\n        // 3. Find Active Event using PURE MATH\n        // Because we padded the timeline in setupLayout(),\n        // the scrollLeft value corresponds exactly to the pixel on the timeline\n        // that is currently under the center playhead.\n\n        let foundEvent = null;\n        let closestDist = CONFIG.TRIGGER_THRESHOLD; // Use your config const (e.g. 200)\n\n        // Fast Loop\n        for (let i = 0; i < eventsData.length; i++) {\n            const event = eventsData[i];\n\n            // Math.abs(EventLocation - CurrentScrollPosition)\n            const dist = Math.abs(event.pixelLocation - scrollLeft);\n\n            if (dist < closestDist) {\n                closestDist = dist;\n                foundEvent = event;\n            }\n        }\n\n        // 4. State Management\n        if (foundEvent && foundEvent.id !== activeEventId) {\n            activateEvent(foundEvent);\n        } else if (!foundEvent && activeEventId !== null) {\n            deactivateEvent();\n        }\n\n        requestAnimationFrame(updateLoop);\n    }\n\n\n\n    // --- INTERACTION LOGIC ---\n\n    function activateEvent(event) {\n        activeEventId = event.id;\n\n        // 1. Update Card Content\n        elements.cardTitle.innerText = event.title;\n        elements.cardDate.innerText = formatFriendlyDate(event.date);\n        elements.cardDesc.innerText = event.description;\n\n        // CHANGED: Logic to show image if it exists, regardless of 'type'\n        if (event.image) {\n            elements.cardImg.src = event.image;\n            elements.cardImgContainer.classList.remove('hidden');\n        } else {\n            elements.cardImgContainer.classList.add('hidden');\n        }\n\n        elements.infoCard.classList.remove('translate-y-[120%]');\n\n        // ... (Keep the rest of the function: \"Matrix Lines\", \"Cinematic BG\", \"Hybrid Check\" etc.)\n        // ...\n        // 2. Handle \"Matrix\" Lines\n        document.querySelectorAll('.state-row, .timeline-row-line').forEach(el => el.classList.remove('active'));\n\n        if (event.involved.includes(\"All\")) {\n            // ... (Keep existing Union Logic)\n            if (event.type === 'large' && event.bgImage) {\n                elements.cinematicBg.style.backgroundImage = `url('${event.bgImage}')`;\n                elements.cinematicBg.classList.remove('opacity-0');\n                elements.sidebar.classList.add('opacity-50');\n                elements.gridLines.classList.add('blur-mode');\n            }\n            if (event.location) {\n                const sidebarRow = document.querySelector(`.state-row[data-state=\"${event.location}\"]`);\n                if (sidebarRow) sidebarRow.classList.add('active');\n                const gridRow = document.querySelector(`.timeline-row-line[data-state-row=\"${event.location}\"]`);\n                if (gridRow) gridRow.classList.add('active');\n            }\n        } else {\n            // ... (Keep existing State Logic)\n            event.involved.forEach(stateName => {\n                const sidebarRow = document.querySelector(`.state-row[data-state=\"${stateName}\"]`);\n                if (sidebarRow) sidebarRow.classList.add('active');\n                const gridRow = document.querySelector(`.timeline-row-line[data-state-row=\"${stateName}\"]`);\n                if (gridRow) gridRow.classList.add('active');\n            });\n        }\n    }\n\n    function deactivateEvent() {\n        activeEventId = null;\n\n        // Hide Card\n        elements.infoCard.classList.add('translate-y-[120%]');\n\n        // Reset Rows\n        document.querySelectorAll('.state-row, .timeline-row-line').forEach(el => el.classList.remove('active'));\n\n        // Reset Cinematic Mode\n        elements.cinematicBg.classList.add('opacity-0');\n        elements.sidebar.classList.remove('opacity-50');\n        elements.gridLines.classList.remove('blur-mode');\n    }\n\n    function formatFriendlyDate(dateString) {\n        // 1. Parse the date ensuring no timezone offsets shift the day\n        const [year, month, day] = dateString.split('-');\n        const date = new Date(year, month - 1, day);\n\n        // 2. Get Month Name\n        const monthName = date.toLocaleString('default', { month: 'long' });\n\n        // 3. Get Day and determine Suffix (st, nd, rd, th)\n        const d = parseInt(day);\n        let suffix = 'th';\n\n        if (d > 3 && d < 21) {\n            suffix = 'th'; // Covers 4-20 (11th, 12th, 13th)\n        } else {\n            switch (d % 10) {\n                case 1:  suffix = \"st\"; break;\n                case 2:  suffix = \"nd\"; break;\n                case 3:  suffix = \"rd\"; break;\n            }\n        }\n\n        return `${monthName} ${d}${suffix}, ${year}`;\n    }\n\n    // Start\n    init();\n</script>\n"},"output-file":"history_2ndamen.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":false,"quarto-version":"1.6.40","theme":"none","title":"Second Amendment History","subtitle":"Timeline of the Second Amendment Development","image":"images/washington.png","categories":["guns","second amendment","interactive","history"],"resources":"data/history_events.json","minimal":true,"anchor-sections":true,"page-layout":"full"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}