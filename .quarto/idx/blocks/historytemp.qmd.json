{"markdown":{"yaml":{"title":"","resources":"data/history_events.json","format":{"html":{"minimal":true,"css":"../styles/historytemp.css","anchor-sections":true,"page-layout":"full","toc":false,"include-in-header":{"text":"<script src=\"https://cdn.tailwindcss.com\"></script>\n\n<link href=\"https://fonts.googleapis.com/css2?family=IM+Fell+English:ital@0;1&family=Lato:wght@400;700&display=swap\" rel=\"stylesheet\">\n"},"include-after-body":{"text":"<script>\n    // --- CONFIGURATION ---\n    const CONFIG = {\n        START_DATE: new Date(\"1785-01-01\"),\n        END_DATE: new Date(\"1790-12-31\"),\n        TOTAL_WIDTH: 12000, // Pixels for the total timeline length\n        TRIGGER_THRESHOLD: 300, // Pixels from center to trigger event\n    };\n\n    // Hardcoded States (sorted by ratification generally, or geographic)\n    const STATES = [\n        { name: \"Delaware\", abbr: \"DE\" },\n        { name: \"Pennsylvania\", abbr: \"PA\" },\n        { name: \"New Jersey\", abbr: \"NJ\" },\n        { name: \"Georgia\", abbr: \"GA\" },\n        { name: \"Connecticut\", abbr: \"CT\" },\n        { name: \"Massachusetts\", abbr: \"MA\" },\n        { name: \"Maryland\", abbr: \"MD\" },\n        { name: \"South Carolina\", abbr: \"SC\" },\n        { name: \"New Hampshire\", abbr: \"NH\" },\n        { name: \"Virginia\", abbr: \"VA\" },\n        { name: \"New York\", abbr: \"NY\" },\n        { name: \"North Carolina\", abbr: \"NC\" },\n        { name: \"Rhode Island\", abbr: \"RI\" }\n    ];\n\n    let eventsData = [];\n    let activeEventId = null;\n\n    // --- DOM ELEMENTS ---\n    const elements = {\n        sidebar: document.getElementById('state-list-container'),\n        timelineViewport: document.getElementById('timeline-viewport'),\n        timelineContent: document.getElementById('timeline-content'),\n        gridLines: document.getElementById('grid-lines'),\n        eventsContainer: document.getElementById('events-container'),\n        infoCard: document.getElementById('info-card'),\n        cinematicBg: document.getElementById('cinematic-bg'),\n        dateDisplay: document.getElementById('current-date-display'),\n        // Card Elements\n        cardTitle: document.getElementById('card-title'),\n        cardDate: document.getElementById('card-date'),\n        cardDesc: document.getElementById('card-desc'),\n        cardImgContainer: document.getElementById('card-image-container'),\n        cardImg: document.getElementById('card-image')\n    };\n\n    // --- INITIALIZATION ---\n\n    async function init() {\n        setupLayout();\n        renderSidebar();\n        renderGridBackground();\n\n        // Fetch Data\n        try {\n            const response = await fetch('data/history_events.json');\n            if (!response.ok) throw new Error('Network response not ok');\n            eventsData = await response.json();\n            renderEvents();\n\n            // Start Loop\n            requestAnimationFrame(updateLoop);\n        } catch (error) {\n            console.error(\"Error loading events:\", error);\n        }\n    }\n\n    function setupLayout() {\n        // 1. Set Timeline Width\n        elements.timelineContent.style.width = `${CONFIG.TOTAL_WIDTH}px`;\n\n        // 2. The Center Scroll Fix\n        // Add 50vw padding to left and right so the start/end can reach the center playhead\n        const halfScreen = window.innerWidth / 2;\n        elements.timelineContent.style.paddingLeft = `${halfScreen}px`;\n        elements.timelineContent.style.paddingRight = `${halfScreen}px`;\n    }\n\n    // --- RENDERING ---\n\n    function renderSidebar() {\n        STATES.forEach((state, index) => {\n            const row = document.createElement('div');\n            row.className = 'state-row h-[40px] flex items-center px-4 font-lato text-sm';\n            row.dataset.state = state.name; // For referencing later\n            row.innerHTML = `\n                <span class=\"hidden md:block font-bold\">${state.name}</span>\n                <span class=\"md:hidden font-bold\">${state.abbr}</span>\n            `;\n            elements.sidebar.appendChild(row);\n        });\n    }\n\n    function renderGridBackground() {\n        // 1. Horizontal Lines (matching sidebar rows)\n        STATES.forEach((state, index) => {\n            const line = document.createElement('div');\n            line.className = 'timeline-row-line h-[40px] w-full absolute';\n            line.style.top = `${index * 40}px`; // Match sidebar height\n            line.dataset.stateRow = state.name;\n            elements.gridLines.appendChild(line);\n        });\n\n        // 2. Vertical Year Markers\n        const startYear = CONFIG.START_DATE.getFullYear();\n        const endYear = CONFIG.END_DATE.getFullYear();\n\n        for (let year = startYear; year <= endYear; year++) {\n            const dateStr = `${year}-01-01`;\n            const leftPos = dateToPixel(dateStr);\n\n            const marker = document.createElement('div');\n            marker.className = 'absolute top-0 bottom-0 border-l border-[#2c1810]/20 font-fell text-4xl text-[#2c1810]/10 pl-2 select-none';\n            marker.style.left = `${leftPos}px`;\n            marker.innerText = year;\n            elements.gridLines.appendChild(marker);\n        }\n    }\n\n    function renderEvents() {\n        eventsData.forEach((event, index) => {\n            const leftPos = dateToPixel(event.date);\n            event.id = index;\n\n            // 1. THE WALL LABEL\n            const label = document.createElement('div');\n            // CHANGED: Added 'md:-top-[40px]' to lift the text up into the header area on desktop\n            label.className = 'absolute top-2 md:-top-[40px] transform -translate-x-1/2 font-fell italic text-2xl text-[#2c1810]/40 whitespace-nowrap select-none z-0 pointer-events-none';\n            label.style.left = `${leftPos}px`;\n            label.innerText = event.title;\n            elements.eventsContainer.appendChild(label);\n\n            // 2. VERTICAL DROP LINE (Dashed - for normal events)\n            const dropLine = document.createElement('div');\n            dropLine.className = 'absolute top-12 bottom-0 border-l border-dashed border-[#2c1810]/20 pointer-events-none';\n            dropLine.style.left = `${leftPos}px`;\n            elements.eventsContainer.appendChild(dropLine);\n\n            // Save element for scroll detection\n            event.domElement = dropLine;\n\n            // 3. State Markers\n            if (event.involved.includes(\"All\")) {\n                // Union Line (For \"All\" events)\n                const unionLine = document.createElement('div');\n                // CHANGED: Added 'md:-top-[50px]' so the line extends to the very top of the screen on desktop\n                unionLine.className = 'absolute top-0 md:-top-[50px] bottom-0 w-[4px] bg-[#2c1810] z-20 transform -translate-x-1/2';\n                unionLine.style.left = `${leftPos}px`;\n\n                const badge = document.createElement('div');\n                badge.className = 'absolute top-[40%] left-1/2 transform -translate-x-1/2 bg-[#2c1810] text-[#fdfbf7] px-3 py-1 font-fell text-lg tracking-widest whitespace-nowrap shadow-lg border border-[#fdfbf7]/20';\n                badge.innerText = event.title.toUpperCase();\n\n                unionLine.appendChild(badge);\n                elements.eventsContainer.appendChild(unionLine);\n            } else {\n                // Individual State Diamonds\n                event.involved.forEach(stateName => {\n                    const stateIndex = STATES.findIndex(s => s.name === stateName);\n                    if (stateIndex === -1) return;\n                    const topPos = (stateIndex * 40) + 20;\n\n                    const diamond = document.createElement('div');\n                    diamond.className = 'marker-diamond absolute w-4 h-4 bg-[#8b0000] rotate-45 transform -translate-x-1/2 -translate-y-1/2 z-20 cursor-help shadow-sm transition-transform hover:scale-150';\n                    diamond.style.left = `${leftPos}px`;\n                    diamond.style.top = `${topPos}px`;\n\n                    if (event.tooltip && event.tooltip[stateName]) {\n                        const tip = document.createElement('div');\n                        tip.className = 'tooltip-box absolute bottom-6 left-1/2 -translate-x-1/2 bg-[#2c1810] text-[#fdfbf7] text-xs p-2 rounded w-[150px] -rotate-45 pointer-events-none z-50 shadow-xl';\n                        tip.innerText = event.tooltip[stateName];\n                        diamond.appendChild(tip);\n                    }\n                    elements.eventsContainer.appendChild(diamond);\n                });\n            }\n        });\n    }\n\n\n    // --- MATH HELPERS ---\n\n    function dateToPixel(dateString) {\n        const date = new Date(dateString);\n        const totalTime = CONFIG.END_DATE - CONFIG.START_DATE;\n        const eventTime = date - CONFIG.START_DATE;\n        const percentage = eventTime / totalTime;\n        return percentage * CONFIG.TOTAL_WIDTH;\n    }\n\n    function pixelToDate(pixel) {\n        const percentage = pixel / CONFIG.TOTAL_WIDTH;\n        const totalTime = CONFIG.END_DATE - CONFIG.START_DATE;\n        const timeElapsed = totalTime * percentage;\n        const newDate = new Date(CONFIG.START_DATE.getTime() + timeElapsed);\n        return newDate.getFullYear(); // Just returning year for display\n    }\n\n    // --- THE GAME LOOP (RequestAnimationFrame) ---\n\n    function updateLoop() {\n        // 1. Get the visual center of the screen (Where the red line is)\n        const screenCenter = window.innerWidth / 2;\n\n        // Update Date Display based on scroll math (this is approximation for the label only)\n        const scrollLeft = elements.timelineViewport.scrollLeft;\n        elements.dateDisplay.innerText = pixelToDate(scrollLeft);\n\n        // 2. Find Active Event using VISUAL POSITION\n        let foundEvent = null;\n\n        // Narrower threshold for snappier feel\n        const VISUAL_THRESHOLD = 50;\n\n        eventsData.forEach(event => {\n            if (!event.domElement) return;\n\n            // Get the line's position relative to the viewport window\n            const rect = event.domElement.getBoundingClientRect();\n\n            // Calculate distance: (Line's Left Position) minus (Screen Center)\n            const dist = Math.abs(rect.left - screenCenter);\n\n            if (dist < VISUAL_THRESHOLD) {\n                foundEvent = event;\n            }\n        });\n\n        if (foundEvent && foundEvent.id !== activeEventId) {\n            activateEvent(foundEvent);\n        } else if (!foundEvent && activeEventId !== null) {\n            // Only deactivate if we moved far enough away from the current event\n            // This prevents flickering if you are just 1 pixel outside the threshold\n            deactivateEvent();\n        }\n\n        requestAnimationFrame(updateLoop);\n    }\n\n    // --- INTERACTION LOGIC ---\n\n    function activateEvent(event) {\n        activeEventId = event.id;\n\n        // 1. Update Card Content\n        elements.cardTitle.innerText = event.title;\n        elements.cardDate.innerText = formatFriendlyDate(event.date);\n        elements.cardDesc.innerText = event.description;\n\n        // Handle Image Types\n        if (event.type === 'medium' || event.type === 'large') {\n            elements.cardImg.src = event.image;\n            elements.cardImgContainer.classList.remove('hidden');\n        } else {\n            elements.cardImgContainer.classList.add('hidden');\n        }\n\n        // Show Card (Slide Up)\n        elements.infoCard.classList.remove('translate-y-[120%]');\n\n        // 2. Handle \"Matrix\" Lines (Row Highlighting)\n        // Clear previous\n        document.querySelectorAll('.state-row, .timeline-row-line').forEach(el => el.classList.remove('active'));\n\n        if (event.involved.includes(\"All\")) {\n            // \"Union\" Mode - Don't highlight rows, trigger cinematic BG\n            if (event.type === 'large' && event.bgImage) {\n                elements.cinematicBg.style.backgroundImage = `url('${event.bgImage}')`;\n                elements.cinematicBg.classList.remove('opacity-0');\n                elements.sidebar.classList.add('opacity-50'); // Dim UI\n                elements.gridLines.classList.add('blur-mode'); // Blur lines\n            }\n        } else {\n            // Specific States Mode\n            event.involved.forEach(stateName => {\n                // Highlight Sidebar Row\n                const sidebarRow = document.querySelector(`.state-row[data-state=\"${stateName}\"]`);\n                if (sidebarRow) sidebarRow.classList.add('active');\n\n                // Highlight Grid Line\n                const gridRow = document.querySelector(`.timeline-row-line[data-state-row=\"${stateName}\"]`);\n                if (gridRow) gridRow.classList.add('active');\n            });\n        }\n    }\n\n    function deactivateEvent() {\n        activeEventId = null;\n\n        // Hide Card\n        elements.infoCard.classList.add('translate-y-[120%]');\n\n        // Reset Rows\n        document.querySelectorAll('.state-row, .timeline-row-line').forEach(el => el.classList.remove('active'));\n\n        // Reset Cinematic Mode\n        elements.cinematicBg.classList.add('opacity-0');\n        elements.sidebar.classList.remove('opacity-50');\n        elements.gridLines.classList.remove('blur-mode');\n    }\n\n    function formatFriendlyDate(dateString) {\n        // 1. Parse the date ensuring no timezone offsets shift the day\n        const [year, month, day] = dateString.split('-');\n        const date = new Date(year, month - 1, day);\n\n        // 2. Get Month Name\n        const monthName = date.toLocaleString('default', { month: 'long' });\n\n        // 3. Get Day and determine Suffix (st, nd, rd, th)\n        const d = parseInt(day);\n        let suffix = 'th';\n\n        if (d > 3 && d < 21) {\n            suffix = 'th'; // Covers 4-20 (11th, 12th, 13th)\n        } else {\n            switch (d % 10) {\n                case 1:  suffix = \"st\"; break;\n                case 2:  suffix = \"nd\"; break;\n                case 3:  suffix = \"rd\"; break;\n            }\n        }\n\n        return `${monthName} ${d}${suffix}, ${year}`;\n    }\n\n    // Start\n    init();\n</script>\n"}}}},"containsRefs":false,"markdown":"\n\n```{=html}\n<body class=\"bg-[#fdfbf7] text-[#2c1810] overflow-hidden h-screen w-screen selection:bg-[#8b0000] selection:text-white\">\n\n    <div id=\"cinematic-bg\" class=\"absolute inset-0 bg-cover bg-center opacity-0 transition-opacity duration-1000 z-0 pointer-events-none\"></div>\n\n    <div class=\"relative z-10 flex h-full w-full\">\n\n        <div id=\"sidebar\" class=\"flex-none w-[60px] md:w-[200px] h-full bg-[#f4f1ea] border-r-2 border-[#dcd6ce] z-20 shadow-xl overflow-hidden relative flex flex-col\">\n            \n            <div class=\"h-[50px] hidden md:flex items-center justify-center border-b border-[#dcd6ce] font-fell italic text-xl flex-none bg-[#f4f1ea] z-10\">\n                <span>United </span>\n            </div>\n            \n            <div id=\"state-list-container\" class=\"flex flex-col overflow-y-auto\">\n                </div>\n        </div>\n\n        <div id=\"timeline-viewport\" class=\"flex-1 relative overflow-x-scroll overflow-y-hidden custom-scrollbar\">\n            \n            <div id=\"playhead\" class=\"fixed top-0 bottom-0 left-1/2 w-[2px] bg-[#8b0000] z-30 transform -translate-x-1/2 pointer-events-none shadow-[0_0_10px_rgba(139,0,0,0.5)]\">\n                <div class=\"absolute top-2 left-1/2 -translate-x-1/2 bg-[#8b0000] text-[#fdfbf7] px-2 py-1 text-xs font-bold rounded font-lato\">\n                    <span id=\"current-date-display\">1785</span>\n                </div>\n            </div>\n\n            <div id=\"timeline-content\" class=\"relative h-full\">\n                \n                <div id=\"timeline-offset\" class=\"relative w-full h-full mt-0 md:mt-[50px]\">\n                    \n                    <div id=\"grid-lines\" class=\"absolute inset-0 pointer-events-none\"></div>\n                    \n                    <div id=\"events-container\" class=\"absolute inset-0 w-full h-full\"></div>\n                    \n                </div>\n            </div>\n\n        </div>\n    </div>\n\n    <div id=\"info-card\" class=\"fixed bottom-0 right-0 md:bottom-8 md:right-8 w-full md:w-[400px] bg-paper border-t-4 md:border-4 border-ink/80 shadow-2xl transform translate-y-[120%] transition-transform duration-500 z-[100] p-6 rounded-t-lg md:rounded-lg\">\n        <div id=\"card-content\">\n            <div id=\"card-image-container\" class=\"hidden mb-4 overflow-hidden rounded border border-[#2c1810] opacity-80 sepia\">\n                <img id=\"card-image\" src=\"\" alt=\"\" class=\"w-full h-48 object-cover\">\n            </div>\n            \n            <h2 id=\"card-title\" class=\"font-fell text-2xl md:text-3xl mb-2 text-[#8b0000] border-b border-[#2c1810]/20 pb-2\">Event Title</h2>\n            <p id=\"card-date\" class=\"font-lato text-xs md:text-sm font-bold text-[#2c1810]/60 mb-2\">Date</p>\n            <p id=\"card-desc\" class=\"font-lato text-sm md:text-base leading-relaxed\">Description goes here.</p>\n        </div>\n    </div>\n\n</body> \n\n```","srcMarkdownNoYaml":"\n\n```{=html}\n<body class=\"bg-[#fdfbf7] text-[#2c1810] overflow-hidden h-screen w-screen selection:bg-[#8b0000] selection:text-white\">\n\n    <div id=\"cinematic-bg\" class=\"absolute inset-0 bg-cover bg-center opacity-0 transition-opacity duration-1000 z-0 pointer-events-none\"></div>\n\n    <div class=\"relative z-10 flex h-full w-full\">\n\n        <div id=\"sidebar\" class=\"flex-none w-[60px] md:w-[200px] h-full bg-[#f4f1ea] border-r-2 border-[#dcd6ce] z-20 shadow-xl overflow-hidden relative flex flex-col\">\n            \n            <div class=\"h-[50px] hidden md:flex items-center justify-center border-b border-[#dcd6ce] font-fell italic text-xl flex-none bg-[#f4f1ea] z-10\">\n                <span>United </span>\n            </div>\n            \n            <div id=\"state-list-container\" class=\"flex flex-col overflow-y-auto\">\n                </div>\n        </div>\n\n        <div id=\"timeline-viewport\" class=\"flex-1 relative overflow-x-scroll overflow-y-hidden custom-scrollbar\">\n            \n            <div id=\"playhead\" class=\"fixed top-0 bottom-0 left-1/2 w-[2px] bg-[#8b0000] z-30 transform -translate-x-1/2 pointer-events-none shadow-[0_0_10px_rgba(139,0,0,0.5)]\">\n                <div class=\"absolute top-2 left-1/2 -translate-x-1/2 bg-[#8b0000] text-[#fdfbf7] px-2 py-1 text-xs font-bold rounded font-lato\">\n                    <span id=\"current-date-display\">1785</span>\n                </div>\n            </div>\n\n            <div id=\"timeline-content\" class=\"relative h-full\">\n                \n                <div id=\"timeline-offset\" class=\"relative w-full h-full mt-0 md:mt-[50px]\">\n                    \n                    <div id=\"grid-lines\" class=\"absolute inset-0 pointer-events-none\"></div>\n                    \n                    <div id=\"events-container\" class=\"absolute inset-0 w-full h-full\"></div>\n                    \n                </div>\n            </div>\n\n        </div>\n    </div>\n\n    <div id=\"info-card\" class=\"fixed bottom-0 right-0 md:bottom-8 md:right-8 w-full md:w-[400px] bg-paper border-t-4 md:border-4 border-ink/80 shadow-2xl transform translate-y-[120%] transition-transform duration-500 z-[100] p-6 rounded-t-lg md:rounded-lg\">\n        <div id=\"card-content\">\n            <div id=\"card-image-container\" class=\"hidden mb-4 overflow-hidden rounded border border-[#2c1810] opacity-80 sepia\">\n                <img id=\"card-image\" src=\"\" alt=\"\" class=\"w-full h-48 object-cover\">\n            </div>\n            \n            <h2 id=\"card-title\" class=\"font-fell text-2xl md:text-3xl mb-2 text-[#8b0000] border-b border-[#2c1810]/20 pb-2\">Event Title</h2>\n            <p id=\"card-date\" class=\"font-lato text-xs md:text-sm font-bold text-[#2c1810]/60 mb-2\">Date</p>\n            <p id=\"card-desc\" class=\"font-lato text-sm md:text-base leading-relaxed\">Description goes here.</p>\n        </div>\n    </div>\n\n</body> \n\n```"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles/historytemp.css"],"toc":false,"include-in-header":{"text":"<script src=\"https://cdn.tailwindcss.com\"></script>\n\n<link href=\"https://fonts.googleapis.com/css2?family=IM+Fell+English:ital@0;1&family=Lato:wght@400;700&display=swap\" rel=\"stylesheet\">\n"},"include-after-body":{"text":"<script>\n    // --- CONFIGURATION ---\n    const CONFIG = {\n        START_DATE: new Date(\"1785-01-01\"),\n        END_DATE: new Date(\"1790-12-31\"),\n        TOTAL_WIDTH: 12000, // Pixels for the total timeline length\n        TRIGGER_THRESHOLD: 300, // Pixels from center to trigger event\n    };\n\n    // Hardcoded States (sorted by ratification generally, or geographic)\n    const STATES = [\n        { name: \"Delaware\", abbr: \"DE\" },\n        { name: \"Pennsylvania\", abbr: \"PA\" },\n        { name: \"New Jersey\", abbr: \"NJ\" },\n        { name: \"Georgia\", abbr: \"GA\" },\n        { name: \"Connecticut\", abbr: \"CT\" },\n        { name: \"Massachusetts\", abbr: \"MA\" },\n        { name: \"Maryland\", abbr: \"MD\" },\n        { name: \"South Carolina\", abbr: \"SC\" },\n        { name: \"New Hampshire\", abbr: \"NH\" },\n        { name: \"Virginia\", abbr: \"VA\" },\n        { name: \"New York\", abbr: \"NY\" },\n        { name: \"North Carolina\", abbr: \"NC\" },\n        { name: \"Rhode Island\", abbr: \"RI\" }\n    ];\n\n    let eventsData = [];\n    let activeEventId = null;\n\n    // --- DOM ELEMENTS ---\n    const elements = {\n        sidebar: document.getElementById('state-list-container'),\n        timelineViewport: document.getElementById('timeline-viewport'),\n        timelineContent: document.getElementById('timeline-content'),\n        gridLines: document.getElementById('grid-lines'),\n        eventsContainer: document.getElementById('events-container'),\n        infoCard: document.getElementById('info-card'),\n        cinematicBg: document.getElementById('cinematic-bg'),\n        dateDisplay: document.getElementById('current-date-display'),\n        // Card Elements\n        cardTitle: document.getElementById('card-title'),\n        cardDate: document.getElementById('card-date'),\n        cardDesc: document.getElementById('card-desc'),\n        cardImgContainer: document.getElementById('card-image-container'),\n        cardImg: document.getElementById('card-image')\n    };\n\n    // --- INITIALIZATION ---\n\n    async function init() {\n        setupLayout();\n        renderSidebar();\n        renderGridBackground();\n\n        // Fetch Data\n        try {\n            const response = await fetch('data/history_events.json');\n            if (!response.ok) throw new Error('Network response not ok');\n            eventsData = await response.json();\n            renderEvents();\n\n            // Start Loop\n            requestAnimationFrame(updateLoop);\n        } catch (error) {\n            console.error(\"Error loading events:\", error);\n        }\n    }\n\n    function setupLayout() {\n        // 1. Set Timeline Width\n        elements.timelineContent.style.width = `${CONFIG.TOTAL_WIDTH}px`;\n\n        // 2. The Center Scroll Fix\n        // Add 50vw padding to left and right so the start/end can reach the center playhead\n        const halfScreen = window.innerWidth / 2;\n        elements.timelineContent.style.paddingLeft = `${halfScreen}px`;\n        elements.timelineContent.style.paddingRight = `${halfScreen}px`;\n    }\n\n    // --- RENDERING ---\n\n    function renderSidebar() {\n        STATES.forEach((state, index) => {\n            const row = document.createElement('div');\n            row.className = 'state-row h-[40px] flex items-center px-4 font-lato text-sm';\n            row.dataset.state = state.name; // For referencing later\n            row.innerHTML = `\n                <span class=\"hidden md:block font-bold\">${state.name}</span>\n                <span class=\"md:hidden font-bold\">${state.abbr}</span>\n            `;\n            elements.sidebar.appendChild(row);\n        });\n    }\n\n    function renderGridBackground() {\n        // 1. Horizontal Lines (matching sidebar rows)\n        STATES.forEach((state, index) => {\n            const line = document.createElement('div');\n            line.className = 'timeline-row-line h-[40px] w-full absolute';\n            line.style.top = `${index * 40}px`; // Match sidebar height\n            line.dataset.stateRow = state.name;\n            elements.gridLines.appendChild(line);\n        });\n\n        // 2. Vertical Year Markers\n        const startYear = CONFIG.START_DATE.getFullYear();\n        const endYear = CONFIG.END_DATE.getFullYear();\n\n        for (let year = startYear; year <= endYear; year++) {\n            const dateStr = `${year}-01-01`;\n            const leftPos = dateToPixel(dateStr);\n\n            const marker = document.createElement('div');\n            marker.className = 'absolute top-0 bottom-0 border-l border-[#2c1810]/20 font-fell text-4xl text-[#2c1810]/10 pl-2 select-none';\n            marker.style.left = `${leftPos}px`;\n            marker.innerText = year;\n            elements.gridLines.appendChild(marker);\n        }\n    }\n\n    function renderEvents() {\n        eventsData.forEach((event, index) => {\n            const leftPos = dateToPixel(event.date);\n            event.id = index;\n\n            // 1. THE WALL LABEL\n            const label = document.createElement('div');\n            // CHANGED: Added 'md:-top-[40px]' to lift the text up into the header area on desktop\n            label.className = 'absolute top-2 md:-top-[40px] transform -translate-x-1/2 font-fell italic text-2xl text-[#2c1810]/40 whitespace-nowrap select-none z-0 pointer-events-none';\n            label.style.left = `${leftPos}px`;\n            label.innerText = event.title;\n            elements.eventsContainer.appendChild(label);\n\n            // 2. VERTICAL DROP LINE (Dashed - for normal events)\n            const dropLine = document.createElement('div');\n            dropLine.className = 'absolute top-12 bottom-0 border-l border-dashed border-[#2c1810]/20 pointer-events-none';\n            dropLine.style.left = `${leftPos}px`;\n            elements.eventsContainer.appendChild(dropLine);\n\n            // Save element for scroll detection\n            event.domElement = dropLine;\n\n            // 3. State Markers\n            if (event.involved.includes(\"All\")) {\n                // Union Line (For \"All\" events)\n                const unionLine = document.createElement('div');\n                // CHANGED: Added 'md:-top-[50px]' so the line extends to the very top of the screen on desktop\n                unionLine.className = 'absolute top-0 md:-top-[50px] bottom-0 w-[4px] bg-[#2c1810] z-20 transform -translate-x-1/2';\n                unionLine.style.left = `${leftPos}px`;\n\n                const badge = document.createElement('div');\n                badge.className = 'absolute top-[40%] left-1/2 transform -translate-x-1/2 bg-[#2c1810] text-[#fdfbf7] px-3 py-1 font-fell text-lg tracking-widest whitespace-nowrap shadow-lg border border-[#fdfbf7]/20';\n                badge.innerText = event.title.toUpperCase();\n\n                unionLine.appendChild(badge);\n                elements.eventsContainer.appendChild(unionLine);\n            } else {\n                // Individual State Diamonds\n                event.involved.forEach(stateName => {\n                    const stateIndex = STATES.findIndex(s => s.name === stateName);\n                    if (stateIndex === -1) return;\n                    const topPos = (stateIndex * 40) + 20;\n\n                    const diamond = document.createElement('div');\n                    diamond.className = 'marker-diamond absolute w-4 h-4 bg-[#8b0000] rotate-45 transform -translate-x-1/2 -translate-y-1/2 z-20 cursor-help shadow-sm transition-transform hover:scale-150';\n                    diamond.style.left = `${leftPos}px`;\n                    diamond.style.top = `${topPos}px`;\n\n                    if (event.tooltip && event.tooltip[stateName]) {\n                        const tip = document.createElement('div');\n                        tip.className = 'tooltip-box absolute bottom-6 left-1/2 -translate-x-1/2 bg-[#2c1810] text-[#fdfbf7] text-xs p-2 rounded w-[150px] -rotate-45 pointer-events-none z-50 shadow-xl';\n                        tip.innerText = event.tooltip[stateName];\n                        diamond.appendChild(tip);\n                    }\n                    elements.eventsContainer.appendChild(diamond);\n                });\n            }\n        });\n    }\n\n\n    // --- MATH HELPERS ---\n\n    function dateToPixel(dateString) {\n        const date = new Date(dateString);\n        const totalTime = CONFIG.END_DATE - CONFIG.START_DATE;\n        const eventTime = date - CONFIG.START_DATE;\n        const percentage = eventTime / totalTime;\n        return percentage * CONFIG.TOTAL_WIDTH;\n    }\n\n    function pixelToDate(pixel) {\n        const percentage = pixel / CONFIG.TOTAL_WIDTH;\n        const totalTime = CONFIG.END_DATE - CONFIG.START_DATE;\n        const timeElapsed = totalTime * percentage;\n        const newDate = new Date(CONFIG.START_DATE.getTime() + timeElapsed);\n        return newDate.getFullYear(); // Just returning year for display\n    }\n\n    // --- THE GAME LOOP (RequestAnimationFrame) ---\n\n    function updateLoop() {\n        // 1. Get the visual center of the screen (Where the red line is)\n        const screenCenter = window.innerWidth / 2;\n\n        // Update Date Display based on scroll math (this is approximation for the label only)\n        const scrollLeft = elements.timelineViewport.scrollLeft;\n        elements.dateDisplay.innerText = pixelToDate(scrollLeft);\n\n        // 2. Find Active Event using VISUAL POSITION\n        let foundEvent = null;\n\n        // Narrower threshold for snappier feel\n        const VISUAL_THRESHOLD = 50;\n\n        eventsData.forEach(event => {\n            if (!event.domElement) return;\n\n            // Get the line's position relative to the viewport window\n            const rect = event.domElement.getBoundingClientRect();\n\n            // Calculate distance: (Line's Left Position) minus (Screen Center)\n            const dist = Math.abs(rect.left - screenCenter);\n\n            if (dist < VISUAL_THRESHOLD) {\n                foundEvent = event;\n            }\n        });\n\n        if (foundEvent && foundEvent.id !== activeEventId) {\n            activateEvent(foundEvent);\n        } else if (!foundEvent && activeEventId !== null) {\n            // Only deactivate if we moved far enough away from the current event\n            // This prevents flickering if you are just 1 pixel outside the threshold\n            deactivateEvent();\n        }\n\n        requestAnimationFrame(updateLoop);\n    }\n\n    // --- INTERACTION LOGIC ---\n\n    function activateEvent(event) {\n        activeEventId = event.id;\n\n        // 1. Update Card Content\n        elements.cardTitle.innerText = event.title;\n        elements.cardDate.innerText = formatFriendlyDate(event.date);\n        elements.cardDesc.innerText = event.description;\n\n        // Handle Image Types\n        if (event.type === 'medium' || event.type === 'large') {\n            elements.cardImg.src = event.image;\n            elements.cardImgContainer.classList.remove('hidden');\n        } else {\n            elements.cardImgContainer.classList.add('hidden');\n        }\n\n        // Show Card (Slide Up)\n        elements.infoCard.classList.remove('translate-y-[120%]');\n\n        // 2. Handle \"Matrix\" Lines (Row Highlighting)\n        // Clear previous\n        document.querySelectorAll('.state-row, .timeline-row-line').forEach(el => el.classList.remove('active'));\n\n        if (event.involved.includes(\"All\")) {\n            // \"Union\" Mode - Don't highlight rows, trigger cinematic BG\n            if (event.type === 'large' && event.bgImage) {\n                elements.cinematicBg.style.backgroundImage = `url('${event.bgImage}')`;\n                elements.cinematicBg.classList.remove('opacity-0');\n                elements.sidebar.classList.add('opacity-50'); // Dim UI\n                elements.gridLines.classList.add('blur-mode'); // Blur lines\n            }\n        } else {\n            // Specific States Mode\n            event.involved.forEach(stateName => {\n                // Highlight Sidebar Row\n                const sidebarRow = document.querySelector(`.state-row[data-state=\"${stateName}\"]`);\n                if (sidebarRow) sidebarRow.classList.add('active');\n\n                // Highlight Grid Line\n                const gridRow = document.querySelector(`.timeline-row-line[data-state-row=\"${stateName}\"]`);\n                if (gridRow) gridRow.classList.add('active');\n            });\n        }\n    }\n\n    function deactivateEvent() {\n        activeEventId = null;\n\n        // Hide Card\n        elements.infoCard.classList.add('translate-y-[120%]');\n\n        // Reset Rows\n        document.querySelectorAll('.state-row, .timeline-row-line').forEach(el => el.classList.remove('active'));\n\n        // Reset Cinematic Mode\n        elements.cinematicBg.classList.add('opacity-0');\n        elements.sidebar.classList.remove('opacity-50');\n        elements.gridLines.classList.remove('blur-mode');\n    }\n\n    function formatFriendlyDate(dateString) {\n        // 1. Parse the date ensuring no timezone offsets shift the day\n        const [year, month, day] = dateString.split('-');\n        const date = new Date(year, month - 1, day);\n\n        // 2. Get Month Name\n        const monthName = date.toLocaleString('default', { month: 'long' });\n\n        // 3. Get Day and determine Suffix (st, nd, rd, th)\n        const d = parseInt(day);\n        let suffix = 'th';\n\n        if (d > 3 && d < 21) {\n            suffix = 'th'; // Covers 4-20 (11th, 12th, 13th)\n        } else {\n            switch (d % 10) {\n                case 1:  suffix = \"st\"; break;\n                case 2:  suffix = \"nd\"; break;\n                case 3:  suffix = \"rd\"; break;\n            }\n        }\n\n        return `${monthName} ${d}${suffix}, ${year}`;\n    }\n\n    // Start\n    init();\n</script>\n"},"output-file":"historytemp.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":false,"quarto-version":"1.6.40","theme":"none","title":"","resources":"data/history_events.json","minimal":true,"anchor-sections":true,"page-layout":"full"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}