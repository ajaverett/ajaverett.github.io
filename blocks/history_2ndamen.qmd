---
title: "Second Amendment History"
subtitle: "Timeline of the Second Amendment Development"
image: "images/washington.png"
categories: ["guns", "second amendment", "interactive", "history"]
resources: [data/history_events.json, images/history/*]
format:
  html:
    minimal: true
    css: ../styles/historytemp.css
    anchor-sections: true
    page-layout: full   
    toc: false
    include-in-header:
          text: |
            <script src="https://cdn.tailwindcss.com"></script>
                
            <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English:ital@0;1&family=Lato:wght@400;700&display=swap" rel="stylesheet">
            
    include-after-body:
      text: |
        <script>
            // --- CONFIGURATION ---
            const CONFIG = {
                START_DATE: new Date("1773-12-01"),
                END_DATE: new Date("1792-12-31"),
                TOTAL_WIDTH: 20000, // Pixels for the total timeline length
                TRIGGER_THRESHOLD: 100, // Pixels from center to trigger event
                VERTICAL_OFFSET: 20,
            };

            // Optimization: Define Month names once globally
            const MONTHS = ["January", "February", "March", "April", "May", "June", 
                            "July", "August", "September", "October", "November", "December"];

            // Hardcoded States (sorted by ratification generally, or geographic)
            const STATES = [
                { name: "Delaware", abbr: "DE" },
                { name: "Pennsylvania", abbr: "PA" },
                { name: "New Jersey", abbr: "NJ" },
                { name: "Georgia", abbr: "GA" },
                { name: "Connecticut", abbr: "CT" },
                { name: "Massachusetts", abbr: "MA" },
                { name: "Maryland", abbr: "MD" },
                { name: "South Carolina", abbr: "SC" },
                { name: "New Hampshire", abbr: "NH" },
                { name: "Virginia", abbr: "VA" },
                { name: "New York", abbr: "NY" },
                { name: "North Carolina", abbr: "NC" },
                { name: "Rhode Island", abbr: "RI" }
            ];

            let eventsData = [];
            let activeEventId = null;
            let lastDateString = '';

            // --- DOM ELEMENTS ---
            const elements = {
                sidebar: document.getElementById('state-list-container'),
                timelineViewport: document.getElementById('timeline-viewport'),
                timelineContent: document.getElementById('timeline-content'),
                gridLines: document.getElementById('grid-lines'),
                eventsContainer: document.getElementById('events-container'),
                infoCard: document.getElementById('info-card'),
                cinematicBg: document.getElementById('cinematic-bg'),
                dateDisplay: document.getElementById('current-date-display'),
                // Card Elements
                cardTitle: document.getElementById('card-title'),
                cardDate: document.getElementById('card-date'),
                cardDesc: document.getElementById('card-desc'),
                cardImgContainer: document.getElementById('card-image-container'),
                cardImg: document.getElementById('card-image'),
                nextBtn: document.getElementById('next-btn')
            };

            // --- INITIALIZATION ---

            async function init() {
                // PERFORMANCE: Inject content-visibility styles dynamically
                // This stops the browser from rendering off-screen pixels
                elements.eventsContainer.style.contentVisibility = 'auto';
                elements.eventsContainer.style.containIntrinsicSize = `${CONFIG.TOTAL_WIDTH}px 500px`;
                elements.gridLines.style.contentVisibility = 'auto';
                elements.gridLines.style.containIntrinsicSize = `${CONFIG.TOTAL_WIDTH}px 500px`;

                setupLayout();
                renderSidebar();
                renderGridBackground();
                
                window.addEventListener('resize', setupLayout);

                document.fonts.ready.then(() => {
                    setupLayout();
                });

                try {
                    const response = await fetch('data/history_events.json');
                    if (!response.ok) throw new Error('Network response not ok');
                    eventsData = await response.json();
                    renderEvents();
                    renderBanners();

                    // --- NEW: NEXT BUTTON LOGIC ---
                    elements.nextBtn.addEventListener('click', () => {
                        const currentPos = elements.timelineViewport.scrollLeft;
                        
                        // Find the first event that is at least 50px ahead of current view
                        // (The 50px buffer prevents getting stuck on the current event)
                        const nextEvent = eventsData.find(e => e.pixelLocation > currentPos + 50);

                        if (nextEvent) {
                            elements.timelineViewport.scrollTo({
                                left: nextEvent.pixelLocation,
                                behavior: 'smooth' 
                            });
                        } else {
                            // Optional: If at the end, loop back to start?
                            // elements.timelineViewport.scrollTo({ left: 0, behavior: 'smooth' });
                        }
                    });
                    

                    requestAnimationFrame(updateLoop);
                } catch (error) {
                    console.error("Error loading events:", error);
                }
            }
            function setupLayout() {

                elements.timelineViewport.style.willChange = 'scroll-position';

                // 1. Set Timeline Total Width
                elements.timelineContent.style.width = `${CONFIG.TOTAL_WIDTH}px`;
                elements.sidebar.style.paddingTop = `${CONFIG.VERTICAL_OFFSET}px`;
                
                // 2. Force content-box logic
                elements.timelineContent.style.boxSizing = 'content-box'; 

                // 3. Dynamic Padding Calculation
                const halfScreen = window.innerWidth / 2;
                
                // Safety check: ensure sidebar exists before measuring
                const sidebarEl = document.getElementById('sidebar');
                const sidebarWidth = sidebarEl ? sidebarEl.getBoundingClientRect().width : 0;

                // LEFT PADDING: 
                // We want pixel 0 of the timeline to sit exactly under the playhead (center screen)
                // when the scroll bar is at 0.
                // Screen Center = Sidebar Width + (Remaining Space / 2) is incorrect logic.
                // Correct Logic: The Playhead is at absolute 50vw.
                // The content container starts at 'sidebarWidth'.
                // So we need padding = (50vw - sidebarWidth).
                const padLeft = halfScreen - sidebarWidth;
                
                elements.timelineContent.style.paddingLeft = `${Math.max(0, padLeft)}px`;
                elements.timelineContent.style.paddingRight = `${halfScreen}px`;
            }
            // --- RENDERING ---

            function renderSidebar() {
                STATES.forEach((state, index) => {
                    const row = document.createElement('div');
                    
                    row.className = 'state-row h-[40px] flex items-center px-4 font-fell text-lg text-[#2c1810]';
                    
                    row.dataset.state = state.name; 
                    row.innerHTML = `
                        <span class="hidden md:block">${state.name}</span>
                        <span class="md:hidden font-bold">${state.abbr}</span>
                    `;
                    elements.sidebar.appendChild(row);
                });
            }

            function renderGridBackground() {
                // 1. Horizontal Lines (matching sidebar rows)
                STATES.forEach((state, index) => {
                        const line = document.createElement('div');
                        line.className = 'timeline-row-line h-[40px] w-full absolute';
                        
                        // CHANGED: Added + 60 to push grid down
                        line.style.top = `${(index * 40) + CONFIG.VERTICAL_OFFSET}px`;
                        
                        line.dataset.stateRow = state.name;
                        elements.gridLines.appendChild(line);
                    });
                // 2. Vertical Year Markers
                const startYear = CONFIG.START_DATE.getFullYear();
                const endYear = CONFIG.END_DATE.getFullYear();

                for (let year = startYear; year <= endYear; year++) {
                    const dateStr = `${year}-01-01`;
                    const leftPos = dateToPixel(dateStr);
                    
                    const marker = document.createElement('div');
                    marker.className = 'absolute top-0 bottom-0 border-l border-[#2c1810]/20 font-fell text-4xl text-[#2c1810]/10 pl-2 select-none';
                    marker.style.left = `${leftPos}px`;
                    marker.innerText = year;
                    elements.gridLines.appendChild(marker);
                }
            }

            function renderEvents() {
                elements.eventsContainer.innerHTML = '';
                const placedLabels = []; 

                eventsData.forEach((event, index) => {
                    // --- OPTIMIZATION STEP ---
                    const leftPos = dateToPixel(event.date);
                    event.pixelLocation = leftPos; // STORE THIS for the update loop
                    event.id = index;
                    // -------------------------

                    // 1. VERTICAL DROP LINE
                    const dropLine = document.createElement('div');
                    dropLine.className = 'absolute top-0 bottom-0 border-l border-dashed border-[#2c1810]/20 pointer-events-none z-0';
                    dropLine.style.left = `${leftPos}px`;
                    elements.eventsContainer.appendChild(dropLine);
                    event.domElement = dropLine; 

                    // CHECK: Is this a "Pure" Union event?
                    const isPureUnion = event.involved.includes("All") && !event.location;

                    if (isPureUnion) {
                        // --- UNION RENDER ---
                        const unionLine = document.createElement('div');
                        unionLine.className = 'absolute top-0 md:-top-[50px] bottom-0 w-[4px] bg-[#2c1810] z-20 transform -translate-x-1/2';
                        unionLine.style.left = `${leftPos}px`;
                        
                        const badge = document.createElement('div');
                        badge.className = 'absolute top-[40%] left-1/2 transform -translate-x-1/2 bg-[#2c1810] text-[#fdfbf7] px-3 py-1 font-fell text-lg tracking-widest whitespace-nowrap shadow-lg border border-[#fdfbf7]/20';
                        badge.innerText = event.title.toUpperCase();
                        
                        unionLine.appendChild(badge);
                        elements.eventsContainer.appendChild(unionLine);
                    
                    } else {
                        // --- STATE/ROW RENDER ---

                        // A. Determine target states
                        let targetStates = [];
                        if (event.location) {
                            targetStates = [event.location];
                        } else {
                            targetStates = event.involved;
                        }

                        // B. Find Primary State (for label placement)
                        const sortedTargets = targetStates.map(name => {
                            return { name, index: STATES.findIndex(s => s.name === name) };
                        }).sort((a, b) => a.index - b.index);

                        const primaryState = sortedTargets[0];
                        if (!primaryState || primaryState.index === -1) return;

                        // C. Render Diamonds
                        targetStates.forEach(stateName => {
                            const sIndex = STATES.findIndex(s => s.name === stateName);
                            if (sIndex === -1) return;
                            
                            const topPos = (sIndex * 40) + 20 + CONFIG.VERTICAL_OFFSET;

                            const wrapper = document.createElement('div');
                            wrapper.className = 'absolute transform -translate-x-1/2 -translate-y-1/2 z-30 group cursor-help';
                            wrapper.style.left = `${leftPos}px`; // Uses calculated pixel
                            wrapper.style.top = `${topPos}px`;

                            const diamond = document.createElement('div');
                            diamond.className = 'w-4 h-4 bg-[#8b0000] rotate-45 shadow-sm transition-transform duration-200 group-hover:scale-150';
                            wrapper.appendChild(diamond);

                            if (event.tooltip && event.tooltip[stateName]) {
                                const tip = document.createElement('div');
                                tip.className = 'absolute top-6 left-1/2 -translate-x-1/2 bg-[#2c1810] text-[#fdfbf7] text-[11px] font-lato tracking-wide p-3 rounded w-max max-w-[220px] opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none shadow-2xl border border-[#fdfbf7]/10 z-50';
                                tip.innerHTML = event.tooltip[stateName];
                                wrapper.appendChild(tip);
                            }
                            elements.eventsContainer.appendChild(wrapper);
                        });

                        // D. Collision Detection & Label Placement
                        let labelX = leftPos + 15; 
                        let labelY = (primaryState.index * 40) + 5 + CONFIG.VERTICAL_OFFSET;
                        
                        let charWidth = event.type === 'large' ? 14 : 10;
                        const textWidth = (event.title.length * charWidth) + 20; 
                        const textHeight = 40; 

                        let collision = true;
                        let safetyCounter = 0;

                        while (collision && safetyCounter < 20) {
                            collision = false;
                            for (const placed of placedLabels) {
                                const xOverlap = (labelX < placed.right + 10) && ((labelX + textWidth) > placed.left);
                                const yOverlap = (labelY < placed.bottom) && ((labelY + textHeight) > placed.top);
                                if (xOverlap && yOverlap) {
                                    collision = true;
                                    labelY += 40;
                                    break;
                                }
                            }
                            safetyCounter++;
                        }

                        placedLabels.push({ left: labelX, right: labelX + textWidth, top: labelY, bottom: labelY + textHeight });

                        const label = document.createElement('div');
                        let baseClasses = 'absolute font-fell italic whitespace-nowrap select-none z-20 pointer-events-none text-[#2c1810] ';
                        
                        if (event.type === 'large') {
                            label.className = baseClasses + 'text-3xl font-bold opacity-100 drop-shadow-md';
                        } else if (event.type === 'medium') {
                            label.className = baseClasses + 'text-xl font-bold opacity-80';
                        } else {
                            label.className = baseClasses + 'text-lg opacity-60';
                        }

                        label.style.left = `${labelX}px`;
                        label.style.top = `${labelY}px`;
                        label.innerText = event.title;
                        elements.eventsContainer.appendChild(label);
                    }
                });
            }

            function renderBanners() {
                eventsData.forEach(event => {
                    if (event.type !== 'banner' || !event.endDate) return;

                    const startX = dateToPixel(event.date);
                    const endX = dateToPixel(event.endDate);
                    const width = endX - startX;

                    // 1. The Horizontal Bar (Visual Duration)
                    const bannerBar = document.createElement('div');
                    // Red background/border with low opacity
                    // Added 'flex' to manage the sticky child correctly
                    bannerBar.className = 'absolute top-0 h-[8px] bg-[#8b0000]/20 border-b border-[#8b0000]/30 z-0 pointer-events-none flex';
                    bannerBar.style.left = `${startX}px`;
                    bannerBar.style.width = `${width}px`;
                    
                    // 2. The Sliding Label (CSS Sticky)
                    const labelDiv = document.createElement('div');
                    
                    // EXPLANATION OF CLASSES:
                    // 'sticky': Tells browser to stick this element to the view
                    // 'left-0': Sticks it to the left edge of the camera
                    // 'mt-3': Pushes it down below the 8px bar
                    // 'pl-2': Adds a little padding so it doesn't touch the screen edge
                    // 'text-[#2c1810]/50': Brown text (slightly more visible 50% opacity)
                    labelDiv.className = 'sticky left-0 mt-3 pl-2 text-[10px] font-bold font-lato text-[#2c1810]/50 uppercase tracking-widest whitespace-nowrap self-start';
                    labelDiv.innerText = `${event.title}`;
                    
                    bannerBar.appendChild(labelDiv);
                    elements.eventsContainer.appendChild(bannerBar);

                    // Save positions (still useful for other logic if needed)
                    event.bannerStart = startX;
                    event.bannerEnd = endX;
                });
            }

            // --- MATH HELPERS ---

            function dateToPixel(dateString) {
                const date = new Date(dateString);
                const totalTime = CONFIG.END_DATE - CONFIG.START_DATE;
                const eventTime = date - CONFIG.START_DATE;
                const percentage = eventTime / totalTime;
                return percentage * CONFIG.TOTAL_WIDTH;
            }

            function pixelToDate(pixel) {
                const percentage = pixel / CONFIG.TOTAL_WIDTH;
                const startMs = CONFIG.START_DATE.getTime();
                const endMs = CONFIG.END_DATE.getTime();
                const totalMs = endMs - startMs;
                const currentMs = startMs + (totalMs * percentage);
                
                const date = new Date(currentMs);
                const year = date.getFullYear();
                const monthIndex = date.getMonth(); 
                
                // FIX 2: Uses global const MONTHS instead of recreating array
                return `${MONTHS[monthIndex]}, ${year}`;
            }

            // --- THE GAME LOOP (RequestAnimationFrame) ---

            function updateLoop() {
                // 1. Get current scroll position (The only DOM read we need)
                const scrollLeft = elements.timelineViewport.scrollLeft;

                // 2. Update Date Display
                // We clamp the value so it doesn't show crazy dates if the user "bounces" the scroll on Mac/iOS
                const clampedPixel = Math.max(0, Math.min(CONFIG.TOTAL_WIDTH, scrollLeft));
                const newDateStr = pixelToDate(clampedPixel);

                // ONLY touch the DOM if the text actually changed
                if (newDateStr !== lastDateString) {
                    elements.dateDisplay.innerText = newDateStr;
                    lastDateString = newDateStr;
                }

                // 3. Find Active Event using PURE MATH
                // Because we padded the timeline in setupLayout(), 
                // the scrollLeft value corresponds exactly to the pixel on the timeline 
                // that is currently under the center playhead.
                
                let foundEvent = null;
                let closestDist = CONFIG.TRIGGER_THRESHOLD; // Use your config const (e.g. 200)

                // Fast Loop
                for (let i = 0; i < eventsData.length; i++) {
                    const event = eventsData[i];
                    
                    // Math.abs(EventLocation - CurrentScrollPosition)
                    const dist = Math.abs(event.pixelLocation - scrollLeft);

                    if (dist < closestDist) {
                        closestDist = dist; 
                        foundEvent = event;
                    }
                }

                // 4. State Management
                if (foundEvent && foundEvent.id !== activeEventId) {
                    activateEvent(foundEvent);
                } else if (!foundEvent && activeEventId !== null) {
                    deactivateEvent();
                }

                requestAnimationFrame(updateLoop);
            }



            // --- INTERACTION LOGIC ---

            function activateEvent(event) {
                activeEventId = event.id;

                // 1. Update Card Content
                elements.cardTitle.innerText = event.title;
                elements.cardDate.innerText = formatFriendlyDate(event.date);                
                elements.cardDesc.innerText = event.description;

                if (event.image) {
                    elements.cardImg.src = event.image;
                    elements.cardImgContainer.classList.remove('hidden');
                } else {
                    elements.cardImgContainer.classList.add('hidden');
                }
                
                elements.infoCard.classList.remove('translate-y-[120%]');
                
                // 2. NEW: Handle Cinematic Background (Universal Check)
                // This now works for 'banner', 'large', or ANY event with a bgImage
                if (event.bgImage) {
                    elements.cinematicBg.style.backgroundImage = `url('${event.bgImage}')`;
                    elements.cinematicBg.classList.remove('opacity-0');
                    
                    // Apply "Focus Mode" styles
                    elements.sidebar.classList.add('opacity-50');
                    elements.gridLines.classList.add('blur-mode');
                } else {
                    // Ensure bg is hidden if the new event doesn't have one
                    elements.cinematicBg.classList.add('opacity-0');
                    elements.sidebar.classList.remove('opacity-50');
                    elements.gridLines.classList.remove('blur-mode');
                }

                // 3. Handle Grid/Sidebar Highlighting (Matrix Lines)
                document.querySelectorAll('.state-row, .timeline-row-line').forEach(el => el.classList.remove('active'));

                // Handle "All" vs Specific States
                if (event.involved.includes("All")) {
                    if (event.location) {
                        highlightState(event.location);
                    }
                } else {
                    event.involved.forEach(stateName => highlightState(stateName));
                }
            }

            // Helper to keep code clean
            function highlightState(stateName) {
                const sidebarRow = document.querySelector(`.state-row[data-state="${stateName}"]`);
                if (sidebarRow) sidebarRow.classList.add('active');
                
                const gridRow = document.querySelector(`.timeline-row-line[data-state-row="${stateName}"]`);
                if (gridRow) gridRow.classList.add('active');
            }

            function deactivateEvent() {
                activeEventId = null;
                
                // Hide Card
                elements.infoCard.classList.add('translate-y-[120%]');
                
                // Reset Rows
                document.querySelectorAll('.state-row, .timeline-row-line').forEach(el => el.classList.remove('active'));

                // Reset Cinematic Mode
                elements.cinematicBg.classList.add('opacity-0');
                elements.sidebar.classList.remove('opacity-50');
                elements.gridLines.classList.remove('blur-mode');
            }

            function formatFriendlyDate(dateString) {
                // 1. Parse the date ensuring no timezone offsets shift the day
                const [year, month, day] = dateString.split('-');
                const date = new Date(year, month - 1, day);

                // 2. Get Month Name
                const monthName = date.toLocaleString('default', { month: 'long' });
                
                // 3. Get Day and determine Suffix (st, nd, rd, th)
                const d = parseInt(day);
                let suffix = 'th';
                
                if (d > 3 && d < 21) {
                    suffix = 'th'; // Covers 4-20 (11th, 12th, 13th)
                } else {
                    switch (d % 10) {
                        case 1:  suffix = "st"; break;
                        case 2:  suffix = "nd"; break;
                        case 3:  suffix = "rd"; break;
                    }
                }

                return `${monthName} ${d}${suffix}, ${year}`;
            }

            // Start
            init();
        </script>
---



<div style="display: none;">
Timeline of the Second Amendment Development
</div>


```{=html}
<div class="bg-[#fdfbf7] text-[#2c1810] overflow-hidden h-screen w-screen selection:bg-[#8b0000] selection:text-white">

    <div id="cinematic-bg" class="absolute inset-0 bg-cover bg-center opacity-0 transition-opacity duration-300 z-0 pointer-events-none"></div>

    <div class="relative z-10 flex h-full w-full">

        <div id="sidebar" class="flex-none w-[60px] md:w-[200px] h-full bg-[#f4f1ea] border-r-2 border-[#dcd6ce] z-20 shadow-xl overflow-hidden relative flex flex-col">
            
            <div class="h-[50px] hidden md:flex items-center justify-center border-b border-[#dcd6ce] font-fell italic text-xl flex-none bg-[#f4f1ea] z-10">
                <span>The States </span>
            </div>
            
            <div id="state-list-container" class="flex flex-col overflow-y-auto flex-1 relative">
                </div>

            <button id="next-btn" class="flex-none w-full h-[60px] bg-[#8b0000] text-[#fdfbf7] flex items-center justify-center hover:bg-[#a00000] transition-colors duration-300 border-t-2 border-[#dcd6ce]">
                <span class="font-bold text-2xl">âž”</span>
            </button>
        </div>

        <div id="timeline-viewport" class="flex-1 relative overflow-x-scroll overflow-y-hidden custom-scrollbar">
                
            <div id="playhead" class="fixed top-0 bottom-0 left-1/2 w-[2px] bg-[#8b0000] z-10 transform -translate-x-1/2 pointer-events-none shadow-[0_0_10px_rgba(139,0,0,0.5)]">
                <div class="hidden md:block absolute top-2 left-1/2 -translate-x-1/2 bg-[#8b0000] text-[#fdfbf7] px-2 py-1 text-xs font-bold rounded font-lato whitespace-nowrap">
                    <span id="current-date-display">1785</span>
                </div>
            </div>

            <div id="timeline-content" class="relative h-full">
                
                <div id="timeline-offset" class="relative w-full h-full mt-0 md:mt-[50px]">
                    
                    <div id="grid-lines" class="absolute inset-0 pointer-events-none"></div>
                    
                    <div id="events-container" class="absolute inset-0 w-full h-full"></div>
                    
                </div>
            </div>

        </div>
    </div>

    <div id="info-card" class="fixed bottom-0 left-[60px] right-0 md:left-auto md:right-8 md:bottom-8 md:w-[400px] bg-[#fdfbf7] border-t md:border-2 border-[#2c1810] shadow-2xl transform translate-y-[120%] transition-transform duration-500 z-40 p-4 rounded-t-lg md:rounded-lg">
        <div id="card-content">
            
            <div id="card-image-container" class="hidden mb-3 overflow-hidden rounded border border-[#2c1810] opacity-100 sepia-[.2]">
                <img id="card-image" src="" alt="" class="w-full h-48 object-cover block">
            </div>
            
            <div class="border-b border-[#2c1810]/20 pb-2 mb-2">
                <h2 id="card-title" class="font-fell text-2xl md:text-3xl text-[#8b0000] leading-none mb-1">Event Title</h2>
                <p id="card-date" class="font-lato text-xs font-bold text-[#2c1810]/50 uppercase tracking-widest">Date</p>
            </div>

            <p id="card-desc" class="font-lato text-sm md:text-base leading-relaxed text-[#2c1810]"></p>
        </div>
    </div>


</div> 

```