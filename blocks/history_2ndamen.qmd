---
title: "Second Amendment History"
subtitle: "Timeline of the Second Amendment Development"
image: "images/washington.png"
categories: ["guns", "second amendment", "interactive", "history"]
resources: data/history_events.json
format:
  html:
    minimal: true
    css: ../styles/historytemp.css
    anchor-sections: true
    page-layout: full   
    toc: false
    include-in-header:
          text: |
            <script src="https://cdn.tailwindcss.com"></script>
                
            <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English:ital@0;1&family=Lato:wght@400;700&display=swap" rel="stylesheet">
            
    include-after-body:
      text: |
        <script>
            // --- CONFIGURATION ---
            const CONFIG = {
                START_DATE: new Date("1787-01-01"),
                END_DATE: new Date("1791-12-31"),
                TOTAL_WIDTH: 9000, // Pixels for the total timeline length
                TRIGGER_THRESHOLD: 300, // Pixels from center to trigger event
            };

            // Hardcoded States (sorted by ratification generally, or geographic)
            const STATES = [
                { name: "Delaware", abbr: "DE" },
                { name: "Pennsylvania", abbr: "PA" },
                { name: "New Jersey", abbr: "NJ" },
                { name: "Georgia", abbr: "GA" },
                { name: "Connecticut", abbr: "CT" },
                { name: "Massachusetts", abbr: "MA" },
                { name: "Maryland", abbr: "MD" },
                { name: "South Carolina", abbr: "SC" },
                { name: "New Hampshire", abbr: "NH" },
                { name: "Virginia", abbr: "VA" },
                { name: "New York", abbr: "NY" },
                { name: "North Carolina", abbr: "NC" },
                { name: "Rhode Island", abbr: "RI" }
            ];

            let eventsData = [];
            let activeEventId = null;

            // --- DOM ELEMENTS ---
            const elements = {
                sidebar: document.getElementById('state-list-container'),
                timelineViewport: document.getElementById('timeline-viewport'),
                timelineContent: document.getElementById('timeline-content'),
                gridLines: document.getElementById('grid-lines'),
                eventsContainer: document.getElementById('events-container'),
                infoCard: document.getElementById('info-card'),
                cinematicBg: document.getElementById('cinematic-bg'),
                dateDisplay: document.getElementById('current-date-display'),
                // Card Elements
                cardTitle: document.getElementById('card-title'),
                cardDate: document.getElementById('card-date'),
                cardDesc: document.getElementById('card-desc'),
                cardImgContainer: document.getElementById('card-image-container'),
                cardImg: document.getElementById('card-image')
            };

            // --- INITIALIZATION ---

            async function init() {
                setupLayout();
                renderSidebar();
                renderGridBackground();
                
                window.addEventListener('resize', setupLayout);

                // Fetch Data
                try {
                    const response = await fetch('data/history_events.json');
                    if (!response.ok) throw new Error('Network response not ok');
                    eventsData = await response.json();
                    renderEvents();
                    
                    // Start Loop
                    requestAnimationFrame(updateLoop);
                } catch (error) {
                    console.error("Error loading events:", error);
                }
            }

            function setupLayout() {
                // 1. Set Timeline Width
                elements.timelineContent.style.width = `${CONFIG.TOTAL_WIDTH}px`;
                
                // 2. Force content-box (Crucial for math accuracy)
                elements.timelineContent.style.boxSizing = 'content-box'; 

                // 3. THE FIX: Dynamic Calculation
                const halfScreen = window.innerWidth / 2;
                
                // Get the actual width of the sidebar (200px on desktop, 60px on mobile)
                const sidebarEl = document.getElementById('sidebar');
                const sidebarWidth = sidebarEl ? sidebarEl.offsetWidth : 0;

                // LEFT PADDING: Subtract sidebar width so the start hits the exact screen center
                elements.timelineContent.style.paddingLeft = `${halfScreen - sidebarWidth}px`;
                
                // RIGHT PADDING: Keeps the end reachable (Standard 50vw)
                elements.timelineContent.style.paddingRight = `${halfScreen}px`;
            }
            // --- RENDERING ---

            function renderSidebar() {
                STATES.forEach((state, index) => {
                    const row = document.createElement('div');
                    
                    row.className = 'state-row h-[40px] flex items-center px-4 font-fell text-lg text-[#2c1810]';
                    
                    row.dataset.state = state.name; 
                    row.innerHTML = `
                        <span class="hidden md:block">${state.name}</span>
                        <span class="md:hidden font-bold">${state.abbr}</span>
                    `;
                    elements.sidebar.appendChild(row);
                });
            }

            function renderGridBackground() {
                // 1. Horizontal Lines (matching sidebar rows)
                STATES.forEach((state, index) => {
                    const line = document.createElement('div');
                    line.className = 'timeline-row-line h-[40px] w-full absolute';
                    line.style.top = `${index * 40}px`; // Match sidebar height
                    line.dataset.stateRow = state.name;
                    elements.gridLines.appendChild(line);
                });

                // 2. Vertical Year Markers
                const startYear = CONFIG.START_DATE.getFullYear();
                const endYear = CONFIG.END_DATE.getFullYear();

                for (let year = startYear; year <= endYear; year++) {
                    const dateStr = `${year}-01-01`;
                    const leftPos = dateToPixel(dateStr);
                    
                    const marker = document.createElement('div');
                    marker.className = 'absolute top-0 bottom-0 border-l border-[#2c1810]/20 font-fell text-4xl text-[#2c1810]/10 pl-2 select-none';
                    marker.style.left = `${leftPos}px`;
                    marker.innerText = year;
                    elements.gridLines.appendChild(marker);
                }
            }

            function renderEvents() {
                elements.eventsContainer.innerHTML = '';
                const placedLabels = []; 

                eventsData.forEach((event, index) => {
                    const leftPos = dateToPixel(event.date);
                    event.id = index;

                    // 1. VERTICAL DROP LINE (Background)
                    const dropLine = document.createElement('div');
                    dropLine.className = 'absolute top-0 bottom-0 border-l border-dashed border-[#2c1810]/20 pointer-events-none z-0';
                    dropLine.style.left = `${leftPos}px`;
                    elements.eventsContainer.appendChild(dropLine);
                    event.domElement = dropLine; 

                    // CHECK: Is this a "Pure" Union event (No specific location)?
                    const isPureUnion = event.involved.includes("All") && !event.location;

                    if (isPureUnion) {
                        // --- RENDER FULL VERTICAL LINE (Old Way) ---
                        const unionLine = document.createElement('div');
                        unionLine.className = 'absolute top-0 md:-top-[50px] bottom-0 w-[4px] bg-[#2c1810] z-20 transform -translate-x-1/2';
                        unionLine.style.left = `${leftPos}px`;
                        
                        const badge = document.createElement('div');
                        badge.className = 'absolute top-[40%] left-1/2 transform -translate-x-1/2 bg-[#2c1810] text-[#fdfbf7] px-3 py-1 font-fell text-lg tracking-widest whitespace-nowrap shadow-lg border border-[#fdfbf7]/20';
                        badge.innerText = event.title.toUpperCase();
                        
                        unionLine.appendChild(badge);
                        elements.eventsContainer.appendChild(unionLine);
                    
                    } else {
                        // --- RENDER ROW-BASED EVENT (State OR Union w/ Location) ---

                        // A. Determine which states get diamonds
                        let targetStates = [];
                        if (event.location) {
                            // Hybrid Case: It's an "All" event, but pinned to ONE location
                            targetStates = [event.location];
                        } else {
                            // Standard Case: It's specific states
                            targetStates = event.involved;
                        }

                        // B. Determine the "Primary" state for the label (highest up)
                        // Sort by sidebar index
                        const sortedTargets = targetStates.map(name => {
                            return { name, index: STATES.findIndex(s => s.name === name) };
                        }).sort((a, b) => a.index - b.index);

                        const primaryState = sortedTargets[0];
                        if (!primaryState || primaryState.index === -1) return;

                        // C. Render Diamonds
                        targetStates.forEach(stateName => {
                            const sIndex = STATES.findIndex(s => s.name === stateName);
                            if (sIndex === -1) return;
                            const topPos = (sIndex * 40) + 20;

                            const diamond = document.createElement('div');
                            // Standard Red Diamond
                            diamond.className = 'marker-diamond absolute w-4 h-4 bg-[#8b0000] rotate-45 transform -translate-x-1/2 -translate-y-1/2 z-30 cursor-help shadow-sm transition-transform hover:scale-150';
                            diamond.style.left = `${leftPos}px`;
                            diamond.style.top = `${topPos}px`;

                            // Tooltip
                            if (event.tooltip && event.tooltip[stateName]) {
                                const tip = document.createElement('div');
                                tip.className = 'tooltip-box absolute bottom-6 left-1/2 -translate-x-1/2 bg-[#2c1810] text-[#fdfbf7] text-xs p-2 rounded w-[150px] -rotate-45 pointer-events-none z-[9999] shadow-xl';
                                tip.innerText = event.tooltip[stateName];
                                diamond.appendChild(tip);
                            }
                            elements.eventsContainer.appendChild(diamond);
                        });

                        // D. Smart Label Placement (Collision Logic)
                        let labelX = leftPos + 15; 
                        let labelY = (primaryState.index * 40) + 5; 
                        const textWidth = (event.title.length * 10) + 20; 
                        const textHeight = 40; 

                        let collision = true;
                        let safetyCounter = 0;

                        while (collision && safetyCounter < 20) {
                            collision = false;
                            for (const placed of placedLabels) {
                                const xOverlap = (labelX < placed.right + 10) && ((labelX + textWidth) > placed.left);
                                const yOverlap = (labelY < placed.bottom) && ((labelY + textHeight) > placed.top);
                                if (xOverlap && yOverlap) {
                                    collision = true;
                                    labelY += 40; // Bump down one row
                                    break;
                                }
                            }
                            safetyCounter++;
                        }

                        placedLabels.push({ left: labelX, right: labelX + textWidth, top: labelY, bottom: labelY + textHeight });

                        const label = document.createElement('div');
                        label.className = 'absolute font-fell italic text-xl text-[#2c1810] whitespace-nowrap select-none z-20 pointer-events-none opacity-90 drop-shadow-sm';
                        label.style.left = `${labelX}px`;
                        label.style.top = `${labelY}px`;
                        label.innerText = event.title;
                        elements.eventsContainer.appendChild(label);
                    }
                });
            }
            // --- MATH HELPERS ---

            function dateToPixel(dateString) {
                const date = new Date(dateString);
                const totalTime = CONFIG.END_DATE - CONFIG.START_DATE;
                const eventTime = date - CONFIG.START_DATE;
                const percentage = eventTime / totalTime;
                return percentage * CONFIG.TOTAL_WIDTH;
            }

            function pixelToDate(pixel) {
                const percentage = pixel / CONFIG.TOTAL_WIDTH;
                const totalTime = CONFIG.END_DATE - CONFIG.START_DATE;
                const timeElapsed = totalTime * percentage;
                const newDate = new Date(CONFIG.START_DATE.getTime() + timeElapsed);
                
                // CHANGED: Format as "Month, Year"
                const month = newDate.toLocaleString('default', { month: 'long' });
                return `${month}, ${newDate.getFullYear()}`; 
            }

            // --- THE GAME LOOP (RequestAnimationFrame) ---

            function updateLoop() {
                // 1. Get the visual center of the screen (Where the red line is)
                const screenCenter = window.innerWidth / 2;

                // Update Date Display based on scroll math
                const scrollLeft = elements.timelineViewport.scrollLeft;
                elements.dateDisplay.innerText = pixelToDate(scrollLeft);

                // 2. Find Active Event using VISUAL POSITION
                let foundEvent = null;
                
                // Narrower threshold for snappier feel
                const VISUAL_THRESHOLD = 50; 
                
                // NEW: Variable to track the closest distance found so far
                let closestDist = VISUAL_THRESHOLD; 

                eventsData.forEach(event => {
                    if (!event.domElement) return;

                    // Get the line's position relative to the viewport window
                    const rect = event.domElement.getBoundingClientRect();
                    
                    // Calculate distance: (Line's Left Position) minus (Screen Center)
                    const dist = Math.abs(rect.left - screenCenter);

                    // CHANGED LOGIC: 
                    // Only update foundEvent if this one is CLOSER than the previous best match
                    if (dist < closestDist) {
                        closestDist = dist; // Update the new record for "closest"
                        foundEvent = event;
                    }
                });

                if (foundEvent && foundEvent.id !== activeEventId) {
                    activateEvent(foundEvent);
                } else if (!foundEvent && activeEventId !== null) {
                    deactivateEvent();
                }

                requestAnimationFrame(updateLoop);
            }

            // --- INTERACTION LOGIC ---

            function activateEvent(event) {
                activeEventId = event.id;

                // 1. Update Card Content (Same as before)
                elements.cardTitle.innerText = event.title;
                elements.cardDate.innerText = formatFriendlyDate(event.date);                
                elements.cardDesc.innerText = event.description;

                if (event.type === 'medium' || event.type === 'large') {
                    elements.cardImg.src = event.image;
                    elements.cardImgContainer.classList.remove('hidden');
                } else {
                    elements.cardImgContainer.classList.add('hidden');
                }
                elements.infoCard.classList.remove('translate-y-[120%]');

                // 2. Handle "Matrix" Lines
                document.querySelectorAll('.state-row, .timeline-row-line').forEach(el => el.classList.remove('active'));

                // NEW LOGIC:
                if (event.involved.includes("All")) {
                    // Triggers Cinematic BG
                    if (event.type === 'large' && event.bgImage) {
                        elements.cinematicBg.style.backgroundImage = `url('${event.bgImage}')`;
                        elements.cinematicBg.classList.remove('opacity-0');
                        elements.sidebar.classList.add('opacity-50');
                        elements.gridLines.classList.add('blur-mode');
                    }

                    // HYBRID CHECK: If it has a specific location, Highlight that row too!
                    if (event.location) {
                        const sidebarRow = document.querySelector(`.state-row[data-state="${event.location}"]`);
                        if (sidebarRow) sidebarRow.classList.add('active');

                        const gridRow = document.querySelector(`.timeline-row-line[data-state-row="${event.location}"]`);
                        if (gridRow) gridRow.classList.add('active');
                    }

                } else {
                    // Standard State Logic
                    event.involved.forEach(stateName => {
                        const sidebarRow = document.querySelector(`.state-row[data-state="${stateName}"]`);
                        if (sidebarRow) sidebarRow.classList.add('active');
                        
                        const gridRow = document.querySelector(`.timeline-row-line[data-state-row="${stateName}"]`);
                        if (gridRow) gridRow.classList.add('active');
                    });
                }
            }

            function deactivateEvent() {
                activeEventId = null;
                
                // Hide Card
                elements.infoCard.classList.add('translate-y-[120%]');
                
                // Reset Rows
                document.querySelectorAll('.state-row, .timeline-row-line').forEach(el => el.classList.remove('active'));

                // Reset Cinematic Mode
                elements.cinematicBg.classList.add('opacity-0');
                elements.sidebar.classList.remove('opacity-50');
                elements.gridLines.classList.remove('blur-mode');
            }

            function formatFriendlyDate(dateString) {
                // 1. Parse the date ensuring no timezone offsets shift the day
                const [year, month, day] = dateString.split('-');
                const date = new Date(year, month - 1, day);

                // 2. Get Month Name
                const monthName = date.toLocaleString('default', { month: 'long' });
                
                // 3. Get Day and determine Suffix (st, nd, rd, th)
                const d = parseInt(day);
                let suffix = 'th';
                
                if (d > 3 && d < 21) {
                    suffix = 'th'; // Covers 4-20 (11th, 12th, 13th)
                } else {
                    switch (d % 10) {
                        case 1:  suffix = "st"; break;
                        case 2:  suffix = "nd"; break;
                        case 3:  suffix = "rd"; break;
                    }
                }

                return `${monthName} ${d}${suffix}, ${year}`;
            }

            // Start
            init();
        </script>
---



<div style="display: none;">
Timeline of the Second Amendment Development
</div>


```{=html}
<body class="bg-[#fdfbf7] text-[#2c1810] overflow-hidden h-screen w-screen selection:bg-[#8b0000] selection:text-white">

    <div id="cinematic-bg" class="absolute inset-0 bg-cover bg-center opacity-0 transition-opacity duration-1000 z-0 pointer-events-none"></div>

    <div class="relative z-10 flex h-full w-full">

        <div id="sidebar" class="flex-none w-[60px] md:w-[200px] h-full bg-[#f4f1ea] border-r-2 border-[#dcd6ce] z-20 shadow-xl overflow-hidden relative flex flex-col">
            
            <div class="h-[50px] hidden md:flex items-center justify-center border-b border-[#dcd6ce] font-fell italic text-xl flex-none bg-[#f4f1ea] z-10">
                <span>The States </span>
            </div>
            
            <div id="state-list-container" class="flex flex-col overflow-y-auto">
                </div>
        </div>

        <div id="timeline-viewport" class="flex-1 relative overflow-x-scroll overflow-y-hidden custom-scrollbar">
            
        <div id="playhead" class="fixed top-0 bottom-0 left-1/2 w-[2px] bg-[#8b0000] z-10 transform -translate-x-1/2 pointer-events-none shadow-[0_0_10px_rgba(139,0,0,0.5)]">
            <div class="hidden md:block absolute top-2 left-1/2 -translate-x-1/2 bg-[#8b0000] text-[#fdfbf7] px-2 py-1 text-xs font-bold rounded font-lato whitespace-nowrap">
                <span id="current-date-display">1785</span>
            </div>
        </div>

            <div id="timeline-content" class="relative h-full">
                
                <div id="timeline-offset" class="relative w-full h-full mt-0 md:mt-[50px]">
                    
                    <div id="grid-lines" class="absolute inset-0 pointer-events-none"></div>
                    
                    <div id="events-container" class="absolute inset-0 w-full h-full"></div>
                    
                </div>
            </div>

        </div>
    </div>

    <div id="info-card" class="fixed bottom-0 left-[60px] right-0 md:left-auto md:right-8 md:bottom-8 md:w-[400px] bg-[#fdfbf7] border-t md:border-2 border-[#2c1810] shadow-2xl transform translate-y-[120%] transition-transform duration-500 z-40 p-4 rounded-t-lg md:rounded-lg">
        <div id="card-content">
            
            <div id="card-image-container" class="hidden mb-3 overflow-hidden rounded border border-[#2c1810] opacity-100 sepia-[.2]">
                <img id="card-image" src="" alt="" class="w-full h-48 object-cover block">
            </div>
            
            <div class="border-b border-[#2c1810]/20 pb-2 mb-2">
                <h2 id="card-title" class="font-fell text-2xl md:text-3xl text-[#8b0000] leading-none mb-1">Event Title</h2>
                <p id="card-date" class="font-lato text-xs font-bold text-[#2c1810]/50 uppercase tracking-widest">Date</p>
            </div>

            <p id="card-desc" class="font-lato text-sm md:text-base leading-relaxed text-[#2c1810]"></p>
        </div>
    </div>

</body> 

```